import{j as e}from"./jsx-runtime.TBa3i5EZ.js";import{r as l}from"./index.CVf8TyFT.js";import{E as bt,n as gt,F as ft,G as wt,H as yt,I as Nt,J as vt,K as jt,L as Ke,M as kt,N as St,O as Ct}from"./fanVault.BPqpPtzw.js";import"./index.BtUICepX.js";const He="the-performa-claude-assistant-v1",qe="the-performa-fan-sync-v1",Ge="the-performa-fan-sync-volume-v1",Qe="the-performa-fan-sync-mute-v1",Ze="the-performa-sync-epoch-v1",F=[{id:"s1",title:"Night Signal I",artist:"Performa Loop",url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",durationSec:372,sourceType:"audio",moods:["hype","mainstage"]},{id:"s2",title:"Afterhours Wire",artist:"Performa Loop",url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",durationSec:357,sourceType:"audio",moods:["dark","afterhours"]},{id:"s3",title:"Velvet Pressure",artist:"Performa Loop",url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3",durationSec:302,sourceType:"audio",moods:["chill","warm"]},{id:"s4",title:"Ignition Grid",artist:"Performa Loop",url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3",durationSec:345,sourceType:"audio",moods:["hype","festival"]},{id:"s5",title:"Ritual Lift",artist:"Performa Loop",url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3",durationSec:410,sourceType:"audio",moods:["afterhours","deep"]}],et=F.reduce((n,i)=>n+i.durationSec,0),tt=()=>new Date().toISOString().slice(0,10),Mt=(n,i)=>{const u=Math.max(0,Math.floor((i-n)/1e3)),h=et>0?u%et:0;let p=0;for(let b=0;b<F.length;b+=1){const k=p+F[b].durationSec;if(h<k)return{track:F[b],index:b,offsetSec:h-p,next:F[(b+1)%F.length]};p=k}return{track:F[0],index:0,offsetSec:0,next:F[1]||F[0]}},It=(n,i)=>{const u=n.toLowerCase();if(u.includes("energy"))return`Energy is at ${i.energy}%, trend ${i.trend.toLowerCase()}. Keep post cadence high for signal lift.`;if(u.includes("stage mode")||u.includes("atlanta"))return`Atlanta is ${i.citySignals.find(b=>b.city.toLowerCase().includes("atlanta"))?.status||"active"} now. Recommended mode: Club Ignition with a 75-90 min pressure arc.`;const h=["dark","hype","afterhours","chill"].find(p=>u.includes(p));if(h){const p=F.find(b=>(b.moods||[]).includes(h))||i.track;return`For a ${h} mood, run "${p.title}" and transition on bar 16 into a tighter low-end build.`}return`Current sync track is "${i.track.title}". City lead is ${i.citySignals[0]?.city||"Atlanta"}. Keep captions concise and cinematic for stronger conversion.`};function Rt({energy:n,trend:i,activeFans:u,citySignals:h,weeklyPrompt:p,rankLabel:b,xp:k,progressPct:m,onUsePrompt:I,onDropAttend:xe,inline:$=!1}){const[J,D]=l.useState(!1),[S,y]=l.useState(!1),[A,ae]=l.useState(.65),[_,ie]=l.useState(!1),[pe,P]=l.useState(Date.now()),[Q,oe]=l.useState(Date.now()),[O,ce]=l.useState(""),[K,he]=l.useState([]),[se,de]=l.useState(""),Z=l.useRef(null),N=l.useRef(null);l.useEffect(()=>{const o=new Audio;return o.preload="auto",N.current=o,()=>{o.pause(),N.current=null}},[]),l.useEffect(()=>{const o=localStorage.getItem(qe),C=localStorage.getItem(Ge),B=localStorage.getItem(Qe),ee=localStorage.getItem(Ze),X=localStorage.getItem(He);if(o&&y(o==="true"),C&&ae(Math.max(0,Math.min(1,Number(C)||.65))),B&&ie(B==="true"),ee)P(Number(ee)||Date.now());else{const E=Date.now()-138e4;P(E),localStorage.setItem(Ze,String(E))}if(X)try{const E=JSON.parse(X);Array.isArray(E)&&he(E.slice(-10))}catch{}const R=new URLSearchParams(window.location.search).get("fanSyncEnabled");(R==="1"||R==="true")&&y(!0),(R==="0"||R==="false")&&y(!1)},[]),l.useEffect(()=>{localStorage.setItem(qe,String(S))},[S]),l.useEffect(()=>{localStorage.setItem(Ge,String(A))},[A]),l.useEffect(()=>{localStorage.setItem(Qe,String(_))},[_]),l.useEffect(()=>{localStorage.setItem(He,JSON.stringify(K.slice(-10)))},[K]),l.useEffect(()=>{const o=window.setInterval(()=>oe(Date.now()),1e3);return()=>window.clearInterval(o)},[]);const g=l.useMemo(()=>Mt(pe,Q),[pe,Q]),v=Math.round(g.offsetSec/Math.max(1,g.track.durationSec)*100);l.useEffect(()=>{const o=N.current;o&&(o.volume=_?0:A)},[A,_]),l.useEffect(()=>{const o=N.current;if(!o)return;if(!S){o.pause(),Z.current=null;return}const C=g.track.url,B=Math.abs((o.currentTime||0)-g.offsetSec);o.src!==C?(o.src=C,o.currentTime=g.offsetSec):B>2.2&&(o.currentTime=g.offsetSec),o.play().catch(()=>{}),Z.current||(Z.current=Date.now())},[S,g.track.url,g.offsetSec]),l.useEffect(()=>{if(!S||!Z.current||se===tt())return;Date.now()-Z.current>=5*60*1e3&&(de(tt()),xe())},[S,Q,se,xe]);const V=o=>{const C=o.trim();if(!C)return;const B={id:`${Date.now()}-u`,role:"user",text:C},ee=It(C,{energy:n,trend:i,citySignals:h,track:g.track}),X={id:`${Date.now()}-a`,role:"assistant",text:ee};he(z=>[...z,B,X].slice(-10)),ce("")},H=e.jsxs("aside",{className:"rounded-[1.6rem] border border-white/15 bg-black/45 p-4 backdrop-blur-xl",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.28em] text-gold/85",children:"Signal Command Center"}),e.jsxs("section",{className:"mt-4 rounded-2xl border border-white/15 bg-black/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.24em] text-white/60",children:"Now Playing"}),e.jsx("span",{className:`rounded-full border px-2 py-1 text-[9px] uppercase tracking-[0.18em] ${S?"border-gold/55 text-gold":"border-white/25 text-white/65"}`,children:S?"Sync Live":"Personal"})]}),e.jsxs("label",{className:"mt-2 flex items-center justify-between text-xs text-white/75",children:[e.jsx("span",{children:"Fan Sync Mode"}),e.jsx("input",{type:"checkbox",checked:S,onChange:o=>y(o.target.checked)})]}),S?e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm text-white/85",children:g.track.title}),e.jsxs("p",{className:"text-[11px] text-white/55",children:[g.track.artist," · Next: ",g.next.title]}),e.jsx("div",{className:"mt-2 h-2 overflow-hidden rounded-full bg-white/10",children:e.jsx("div",{className:"h-full rounded-full bg-[rgb(var(--accent-rgb))] transition-all duration-500",style:{width:`${v}%`}})}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>ie(o=>!o),className:"rounded-full border border-white/25 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-white/70",children:_?"Unmute":"Mute"}),e.jsx("input",{type:"range",min:0,max:1,step:.01,value:A,onChange:o=>ae(Number(o.target.value)),className:"w-full"})]})]}):e.jsx("div",{className:"mt-3 overflow-hidden rounded-xl border border-white/15 bg-black/40",children:e.jsx("iframe",{src:"https://w.soundcloud.com/player/?url=https%3A//soundcloud.com/chipleetheperforma",title:"SoundCloud mini player",className:"h-[120px] w-full",allow:"autoplay",loading:"lazy"})})]}),e.jsxs("section",{className:"mt-3 rounded-2xl border border-white/15 bg-black/30 p-3",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.24em] text-white/60",children:"Live Room Pulse"}),e.jsxs("p",{className:"mt-2 text-sm text-white/90",children:["Energy tonight: ",n,"%"]}),e.jsxs("p",{className:"text-[11px] text-white/55",children:["Trend: ",i]})]}),e.jsxs("section",{className:"mt-3 rounded-2xl border border-white/15 bg-black/30 p-3",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.24em] text-white/60",children:"Active Fans"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:u.slice(0,8).map(o=>e.jsx("span",{className:`inline-flex h-8 w-8 items-center justify-center rounded-full border text-[10px] ${o.online?"border-gold/60 text-gold":"border-white/25 text-white/65"}`,title:o.name,children:o.name.slice(0,2).toUpperCase()},o.id))}),e.jsxs("p",{className:"mt-2 text-[11px] text-white/55",children:[u.filter(o=>o.online).length," online"]})]}),e.jsxs("section",{className:"mt-3 rounded-2xl border border-white/15 bg-black/30 p-3",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.24em] text-white/60",children:"City Signals"}),e.jsx("div",{className:"mt-2 space-y-2",children:h.slice(0,5).map(o=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-[11px] text-white/72",children:[e.jsx("span",{children:o.city}),e.jsx("span",{children:o.status})]}),e.jsx("div",{className:"mt-1 h-1.5 overflow-hidden rounded-full bg-white/10",children:e.jsx("div",{className:"h-full rounded-full bg-[rgb(var(--accent-rgb))]",style:{width:`${o.score}%`}})})]},o.city))})]}),e.jsxs("section",{className:"mt-3 rounded-2xl border border-white/15 bg-black/30 p-3",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.24em] text-white/60",children:"Signal Level"}),e.jsx("p",{className:"mt-2 text-sm text-white/90",children:b}),e.jsxs("p",{className:"text-[11px] text-white/55",children:["XP: ",k]}),e.jsx("div",{className:"mt-2 h-2 overflow-hidden rounded-full bg-white/10",children:e.jsx("div",{className:"h-full rounded-full bg-[rgb(var(--accent-rgb))] transition-all duration-300",style:{width:`${m}%`}})})]}),e.jsxs("section",{className:"mt-3 rounded-2xl border border-white/15 bg-black/30 p-3",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.24em] text-white/60",children:"Weekly Prompt"}),e.jsx("p",{className:"mt-2 text-sm text-white/80",children:p}),e.jsx("button",{type:"button",onClick:I,className:"mt-3 min-h-10 rounded-full border border-gold/45 px-4 py-2 text-[10px] uppercase tracking-[0.2em] text-gold",children:"Post Today's Prompt"})]}),e.jsxs("section",{className:"mt-3 rounded-2xl border border-white/15 bg-black/30 p-3",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.24em] text-white/60",children:"Ask Claude (Performa AI)"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:["What's tonight's energy?","Suggest a track for this mood","What Stage Mode fits Atlanta?"].map(o=>e.jsx("button",{type:"button",onClick:()=>V(o),className:"rounded-full border border-white/20 px-3 py-1 text-[10px] text-white/70",children:o},o))}),e.jsxs("div",{className:"mt-3 max-h-40 space-y-2 overflow-auto rounded-xl border border-white/10 bg-black/35 p-2",children:[K.length===0&&e.jsx("p",{className:"text-[11px] text-white/50",children:"Assistant ready."}),K.map(o=>e.jsxs("p",{className:`text-[11px] ${o.role==="assistant"?"text-gold/90":"text-white/80"}`,children:[o.role==="assistant"?"Claude: ":"You: ",o.text]},o.id))]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("input",{value:O,onChange:o=>ce(o.target.value),placeholder:"Ask Performa AI...",className:"min-h-10 flex-1 rounded-full border border-white/20 bg-black/40 px-3 py-2 text-xs text-white"}),e.jsx("button",{type:"button",onClick:()=>V(O),className:"min-h-10 rounded-full border border-gold/45 px-3 py-2 text-[10px] uppercase tracking-[0.18em] text-gold",children:"Send"})]})]})]});return $?H:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx("div",{className:"fixed right-[max(1rem,calc((100vw-72rem)/2+1rem))] top-24 z-30 w-[340px] max-h-[calc(100vh-7rem)] overflow-auto",children:H})}),e.jsxs("div",{className:"lg:hidden",children:[e.jsx("button",{type:"button",onClick:()=>D(!0),className:"min-h-11 rounded-full border border-white/25 bg-black/45 px-4 py-2 text-xs uppercase tracking-[0.24em] text-white/80",children:"Open Command Center"}),J&&e.jsx("div",{className:"fixed inset-0 z-[90] bg-black/70 p-4",children:e.jsxs("div",{className:"mx-auto max-h-[92vh] w-full max-w-md overflow-auto",children:[e.jsx("div",{className:"mb-3 flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>D(!1),className:"min-h-10 rounded-full border border-white/25 px-4 py-2 text-[10px] uppercase tracking-[0.2em] text-white/80",children:"Close"})}),H]})})]})]})}const Ne="the-performa-feed-profile-v1",rt="the-performa-feed-activity-v1",Te="the-performa-feed-city-signals-v1",Pt="the-performa-blueprint-draft-v1",Se="[[BLUEPRINT]]",Ce="[[RUN_BUN]]",Ae="[[TRIVIA]]",Bt=60,ve=1,Ue=15,$e=[{label:"Run It",imageUrl:""},{label:"Bun It",imageUrl:""}],me=[{label:"Listener",minXp:0},{label:"Insider",minXp:100},{label:"Afterhours Regular",minXp:250},{label:"Vault Member",minXp:500},{label:"Mainstage Signal",minXp:900},{label:"Inner Circle",minXp:1400}],at=["Drop your best afterhours photo.","Show your Performa fit.","Post your city's nightlife signal.","What track defines your week?","Your cleanest transition moment-link it.","Where should The Performa route next?","A photo that feels like ignition.","Best crowd moment from this week?","Post a promoter blueprint for your city.","Share a clip that matches tonight's pulse.","What set opener should hit first?","Tag your city's afterhours mood.","Pick one track for a mainstage rise.","What venue type are you building next?"],Tt=["SignalRunner","NightArchitect","VaultPilot","AfterhoursFox","PulseWarden","DeckVision","CitySpark","NeonTransit","RouteCaller","CrowdCurrent","EchoDriver","MainstageRay","RitualWire","ClubFrame","SkylineDrop","TempoScout","HouseSignal","LiveCompass","KineticFlux","AuralShift","DriftArray","StageSpark","MotionDeck","WireHalo"],Ut=[{city:"Atlanta",score:74,status:"Active"},{city:"NYC",score:62,status:"Rising"},{city:"LA",score:58,status:"Afterhours"},{city:"Miami",score:55,status:"Steady"},{city:"Chicago",score:49,status:"Warming"}],le=n=>{try{return new Intl.DateTimeFormat("en-US",{dateStyle:"medium",timeStyle:"short"}).format(new Date(n))}catch{return n}},Ee=()=>new Date().toISOString().slice(0,10),$t=()=>{const n=new Date,i=new Date(n.getFullYear(),0,0),u=n.getTime()-i.getTime();return Math.floor(u/864e5)},Le=n=>{const i=n.toLowerCase();return/\.(png|jpe?g|webp|gif|avif)(\?|$)/.test(i)?"image":i.includes("youtube.com")||i.includes("youtu.be")||i.includes("vimeo.com")||/\.(mp4|webm|mov)(\?|$)/.test(i)?"video":"link"},re=n=>{try{const i=new URL(n);return i.protocol!=="https:"&&i.protocol!=="http:"?null:i.toString()}catch{return null}},At=n=>{try{const i=new URL(n);if(i.hostname.includes("youtube.com")){const u=i.searchParams.get("v");return u?`https://www.youtube.com/embed/${u}`:null}if(i.hostname.includes("youtu.be")){const u=i.pathname.replace("/","");return u?`https://www.youtube.com/embed/${u}`:null}if(i.hostname.includes("vimeo.com")){const u=i.pathname.split("/").filter(Boolean)[0];return u?`https://player.vimeo.com/video/${u}`:null}}catch{return null}return null},st=n=>n.trim()?Le(n):null,Et=n=>{if(!n.startsWith(Se))return{cleanBody:n,blueprint:null};const i=n.slice(Se.length).trim(),u=i.indexOf(`
`),h=u>=0?i.slice(0,u):i,p=u>=0?i.slice(u+1):"";try{const b=JSON.parse(h);return{cleanBody:p,blueprint:b}}catch{return{cleanBody:n,blueprint:null}}},Lt=n=>n.startsWith(Ce)?{cleanBody:n.slice(Ce.length).replace(/^\s+/,""),isRunBun:!0}:{cleanBody:n,isRunBun:!1},Ft=n=>{if(!n.startsWith(Ae))return{cleanBody:n,isTrivia:!1,triviaMeta:null};const i=n.slice(Ae.length).trim(),u=i.indexOf(`
`),h=u>=0?i.slice(0,u):i,p=u>=0?i.slice(u+1):"";try{const b=JSON.parse(h);return{cleanBody:p,isTrivia:!0,triviaMeta:b||null}}catch{return{cleanBody:i,isTrivia:!0,triviaMeta:null}}},nt=n=>n.toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),Dt=n=>{const i=String(n||"").trim();return i&&/^#(?:[0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(i)?i:null},_t=n=>{const i=Math.max(0,n),u=Math.floor(i/1e3),h=Math.floor(u/60),p=u%60;return`${String(h).padStart(2,"0")}:${String(p).padStart(2,"0")}`},je=n=>n==="approved"?null:n==="pending"?"Under review":n==="flagged"?"Flagged":n==="rejected"?"Restricted":null,Ot=n=>{const i=[...me].reverse().find(k=>n>=k.minXp)||me[0],u=me.findIndex(k=>k.label===i.label),h=me[Math.min(me.length-1,u+1)],p=Math.max(1,h.minXp-i.minXp),b=h.label===i.label?100:Math.round((n-i.minXp)/p*100);return{current:i.label,progress:Math.max(0,Math.min(100,b))}},ke=n=>({userId:n,xp:0,likeDay:Ee(),likesToday:0,dropRewardDay:""});function Wt(){const[n,i]=l.useState(null),[u,h]=l.useState(!0),[p,b]=l.useState(!1),[k,m]=l.useState(""),[I,xe]=l.useState([]),[$,J]=l.useState(""),[D,S]=l.useState(""),[y,A]=l.useState(null),[ae,_]=l.useState({}),[ie,pe]=l.useState({}),[P,Q]=l.useState(null),[oe,O]=l.useState(ke("anon")),[ce,K]=l.useState([]),[he,se]=l.useState(Ut),[de,Z]=l.useState([]),[N,g]=l.useState(!1),[v,V]=l.useState(!1),[H,o]=l.useState(5),[C,B]=l.useState(""),[ee,X]=l.useState(!1),[z,R]=l.useState([{label:"",imageUrl:""},{label:"",imageUrl:""}]),[E,be]=l.useState({}),[T,ne]=l.useState(null),[lt,it]=l.useState(()=>Date.now()),[te,Me]=l.useState("all"),Fe=l.useRef({}),ge=l.useRef({}),fe=l.useRef(null),Ie=l.useRef({}),De=l.useMemo(()=>at[$t()%at.length],[]),ue=(t,s)=>{n&&O(r=>{const a={...r,xp:r.xp+t};return localStorage.setItem(Ne,JSON.stringify(a)),m(`+${t} XP - ${s}`),a})},we=t=>{const s=Date.now();K(r=>{const a=[...r,{type:t,ts:s}].filter(d=>s-d.ts<=24e5);return localStorage.setItem(rt,JSON.stringify(a)),a})},Y=async()=>{const t=await Ct(36);if(!t.ok){m(t.error);return}const s=t.posts.map(r=>{const a=Ft(r.body),d=Lt(a.cleanBody),c=Et(d.cleanBody);return{...r,postType:r.poll?d.isRunBun?"runbun":a.isTrivia?"trivia":"poll":c.blueprint?"blueprint":r.mediaUrl?"media":"text",cleanBody:c.cleanBody,blueprint:c.blueprint,triviaMeta:a.triviaMeta}});xe(s)};l.useEffect(()=>{let t=!1;(async()=>{h(!0);const a=await gt();if(!t&&(i(a),a)){const x=localStorage.getItem(Ne);if(x)try{const f=JSON.parse(x);O({...ke(a.id),...f,userId:a.id})}catch{O(ke(a.id))}else O(ke(a.id))}const d=localStorage.getItem(rt);if(d)try{const x=JSON.parse(d);K(Array.isArray(x)?x:[])}catch{K([])}const c=localStorage.getItem(Te);if(c)try{const x=JSON.parse(c);Array.isArray(x)&&x.length&&se(x)}catch{}await Y(),t||h(!1)})();const r=bt(()=>{Y()});return()=>{t=!0,r&&r()}},[]),l.useEffect(()=>{if(!n)return;const t={};let s=0;I.forEach(r=>{if(t[r.id]=r.likeCount,r.userId!==n.id)return;const a=Fe.current[r.id]??r.likeCount;r.likeCount>a&&(s+=r.likeCount-a)}),Fe.current=t,s>0&&ue(s*5,"Received likes")},[I,n]),l.useEffect(()=>{const t=()=>{const r=Math.floor(Date.now()/6e4),a=Tt.map((d,c)=>({id:`fan-${c}`,name:d,online:(c*13+r)%5<=1}));Z(a)};t();const s=window.setInterval(t,45e3);return()=>window.clearInterval(s)},[]),l.useEffect(()=>{const t=window.setInterval(()=>it(Date.now()),1e3);return()=>window.clearInterval(t)},[]),l.useEffect(()=>{const t=window.setInterval(()=>{se(s=>{const r=s.map((a,d)=>{const c=(Date.now()/1e3+d*7)%3-1,x=Math.max(20,Math.min(95,Math.round(a.score+c))),f=x>=70?"Active":x>=58?"Rising":x>=46?"Steady":"Afterhours";return{...a,score:x,status:f}});return localStorage.setItem(Te,JSON.stringify(r)),r})},3e4);return()=>window.clearInterval(t)},[]),l.useEffect(()=>{I.length&&se(t=>{const s=new Map;if(I.slice(0,24).forEach(a=>{const d=a.blueprint?.city?.trim();d&&s.set(d,(s.get(d)||0)+3)}),!s.size)return t;const r=t.map(a=>{const d=s.get(a.city)||s.get(a.city.toLowerCase())||0;if(!d)return a;const c=Math.min(98,a.score+d),x=c>=70?"Active":c>=58?"Rising":c>=46?"Steady":"Afterhours";return{...a,score:c,status:x}});return localStorage.setItem(Te,JSON.stringify(r)),r})},[I]),l.useEffect(()=>{const t=new URLSearchParams(window.location.search),s=t.get("draft");if(!s)return;const r=localStorage.getItem(Pt);if(r)try{const a=JSON.parse(r);if(a.id!==s)return;g(!1),V(!1),ne(a.payload),g(!0),B(`Run this blueprint: ${a.payload.title}?`),X(!1),R($e),J(`Promoter share: ${a.payload.title}`),m("Blueprint poll draft loaded."),t.delete("draft"),window.history.replaceState({},"",`${window.location.pathname}${t.toString()?`?${t.toString()}`:""}`)}catch{}},[]),l.useEffect(()=>{if(!k)return;const t=window.setTimeout(()=>m(""),2200);return()=>window.clearTimeout(t)},[k]),l.useEffect(()=>{be(t=>{const s={...t};return I.forEach(r=>{if(!r.poll)return;const a=r.poll.options.filter(d=>d.viewerVoted).map(d=>d.id);a.length&&(s[r.id]=a)}),s})},[I]);const Re=l.useMemo(()=>{const t=Date.now(),s=(f,L)=>ce.filter(M=>t-M.ts<=L&&t-M.ts>f),r=f=>{const L=f.filter(w=>w.type==="post").length,M=f.filter(w=>w.type==="comment").length,W=f.filter(w=>w.type==="like").length,G=f.filter(w=>w.type==="share").length;return L*5+M*2+W+G*2},a=r(s(0,10*60*1e3)),d=r(s(10*60*1e3,20*60*1e3)),c=Math.max(8,Math.min(98,Math.round(20+a*3.8))),x=a>d+2?"Rising":a+2<d?"Cooling":"Steady";return{pct:c,trend:x}},[ce]),Pe=l.useMemo(()=>Ot(oe.xp),[oe.xp]),ot=l.useMemo(()=>de.reduce((t,s)=>t+(s.online?1:0),0),[de]),_e=l.useMemo(()=>te==="media"?I.filter(t=>!!t.mediaUrl):te==="polls"?I.filter(t=>!!t.poll):I,[te,I]),Oe=l.useMemo(()=>{if(v)return!!(y||D.trim());if(N){if(T)return!!C.trim();const t=z.filter(s=>s.label.trim().length>0);return!!C.trim()&&t.length>=2}return $.trim().length>0||D.trim().length>0||!!y},[$,D,y,N,v,C,z,T]),Ve=async()=>{if(!p){if(!n){m("Log in to Fan Vault to publish posts.");return}if(!Oe){m(v?"Add a photo or image URL for Run It / Bun It.":N?"Add a poll question and at least two options.":"Add text, a media link, or a photo before publishing.");return}b(!0);try{let t=D.trim(),s=t?Le(t):null;if(t){const c=re(t);if(!c){m("Media URL must start with http:// or https://.");return}if(t=c,v&&Le(t)!=="image"){m("Run It / Bun It requires an image URL.");return}}if(y){const c=await ft(y);if(!c.ok){m(c.error);return}t=c.url,s="image"}const r=T?`${Se}${JSON.stringify(T)}
${$.trim()}`:v?`${Ce}
${$.trim()}`:$.trim(),a=v?{question:"Run It or Bun It?",allowMultiple:!1,expiresAt:new Date(Date.now()+Math.max(ve,Math.min(Ue,H))*60*1e3).toISOString(),options:[{label:"Run It",imageUrl:""},{label:"Bun It",imageUrl:""}]}:N?{question:C.trim(),allowMultiple:ee,options:(T?$e:z).map(c=>({label:c.label.trim(),imageUrl:c.imageUrl.trim()})).filter(c=>c.label.length>0)}:void 0,d=await wt({body:r,mediaUrl:t||null,mediaType:s,poll:a});if(!d.ok){m(d.error);return}J(""),S(""),A(null),g(!1),V(!1),ne(null),B(""),X(!1),o(5),R([{label:"",imageUrl:""},{label:"",imageUrl:""}]),we("post"),ue(25,"Post published"),m("Post published."),await Y()}catch(t){const s=t instanceof Error?t.message:"Could not publish post.";m(s)}finally{b(!1)}}},Xe=async t=>{if(!n){m("Log in to Fan Vault to like posts.");return}const s=await yt(t);if(!s.ok){m(s.error);return}we("like"),O(r=>{const a=Ee(),d=r.likeDay===a?r.likesToday:0;if(d>=20)return{...r,likeDay:a,likesToday:d};const c={...r,likeDay:a,likesToday:d+1,xp:r.xp+2};return localStorage.setItem(Ne,JSON.stringify(c)),c}),await Y()},q=async(t,s)=>{if(!n){m("Log in to Fan Vault to vote.");return}if(!t.poll)return;if(!s.length){m("Pick at least one option.");return}const r=await Nt({postId:t.id,optionIds:s});if(!r.ok){m(r.error);return}be(a=>({...a,[t.id]:s})),ue(6,"Crowd Beacon vote"),m("Vote submitted."),await Y()},ze=async t=>{if(!n){m("Log in to Fan Vault to comment.");return}const s=(ae[t]||"").trim();if(!s)return;const r=await vt(t,s);if(!r.ok){m(r.error);return}_(a=>({...a,[t]:""})),P===t&&Q(null),we("comment"),ue(10,"Comment"),await Y()},Ye=async t=>{const s=`${window.location.origin}/feed#post-${t.id}`,r=t.blueprint?.shareLink||s;try{navigator.share?await navigator.share({title:"The Performa Link Up",text:"Tap into this signal post.",url:s}):await navigator.clipboard.writeText(s),await jt(t.id),we("share"),ue(15,"Shared signal"),m(`Post shared${r&&r!==s?` (${r})`:""}.`),await Y()}catch{m("Share cancelled.")}},ct=async t=>{const s=window.prompt("Report reason (hate, sexual, harassment, violence, spam, other):","other");if(!s)return;const r=await Ke({targetType:"post",targetId:t,reasonCode:s});if(!r.ok){m(r.error);return}m("Report submitted. Thank you.")},dt=async t=>{if(!n||t.userId!==n.id)return;const s=t.cleanBody||"",r=window.prompt("Edit your post text:",s);if(r===null)return;const a=t.mediaUrl||"",d=window.prompt("Edit media URL (leave blank for none):",a);if(d===null)return;const c=d.trim();let x=r.trim();if(t.postType==="blueprint"&&t.blueprint)x=`${Se}${JSON.stringify(t.blueprint)}
${x}`;else if(t.postType==="trivia"&&t.triviaMeta)x=`${Ae}${JSON.stringify(t.triviaMeta)}
${x}`;else if(t.postType==="runbun"){if(c&&st(c)!=="image"){m("Run It / Bun It posts require an image URL.");return}x=`${Ce}
${x}`}const f=await kt({postId:t.id,body:x,mediaUrl:c||null,mediaType:st(c||"")});if(!f.ok){m(f.error);return}m("Post updated."),await Y()},ut=async t=>{if(!n||t.userId!==n.id||!window.confirm("Delete this post? This cannot be undone."))return;const r=await St(t.id);if(!r.ok){m(r.error);return}m("Post deleted."),await Y()},mt=async t=>{const s=window.prompt("Report reason (hate, sexual, harassment, violence, spam, other):","other");if(!s)return;const r=await Ke({targetType:"comment",targetId:t,reasonCode:s});if(!r.ok){m(r.error);return}m("Report submitted. Thank you.")},Be=()=>{document.getElementById("link-up-composer")?.scrollIntoView({behavior:"smooth",block:"start"}),window.setTimeout(()=>fe.current?.focus(),140)},xt=()=>{J(De),g(!1),V(!1),ne(null),Be()},We=t=>{Q(t),document.getElementById(`post-${t}`)?.scrollIntoView({behavior:"smooth",block:"end"}),window.setTimeout(()=>Ie.current[t]?.focus(),140)},pt=()=>{O(t=>{const s=Ee();if(t.dropRewardDay===s)return t;const r={...t,dropRewardDay:s,xp:t.xp+20};return localStorage.setItem(Ne,JSON.stringify(r)),m("+20 XP - Drop attendance"),r})};return e.jsxs("div",{className:"grid items-start gap-4 md:gap-5 xl:min-h-[58rem]",children:[e.jsxs("div",{className:"sticky top-[5.2rem] z-30 -mx-1 flex items-center gap-2 overflow-x-auto rounded-2xl border border-white/15 bg-black/70 px-2 py-2 backdrop-blur-xl sm:hidden",children:[e.jsx("button",{type:"button",onClick:Be,className:"min-h-10 whitespace-nowrap rounded-full border border-gold/45 bg-gold/10 px-4 py-2 text-[10px] uppercase tracking-[0.2em] text-gold",children:"Compose"}),e.jsx("button",{type:"button",onClick:()=>Me("all"),className:`min-h-10 whitespace-nowrap rounded-full border px-4 py-2 text-[10px] uppercase tracking-[0.2em] ${te==="all"?"border-white/45 bg-white/10 text-white":"border-white/25 bg-black/35 text-white/80"}`,children:"For You"}),e.jsx("button",{type:"button",onClick:()=>Me("media"),className:`min-h-10 whitespace-nowrap rounded-full border px-4 py-2 text-[10px] uppercase tracking-[0.2em] ${te==="media"?"border-white/45 bg-white/10 text-white":"border-white/25 bg-black/35 text-white/80"}`,children:"Media"}),e.jsx("button",{type:"button",onClick:()=>Me("polls"),className:`min-h-10 whitespace-nowrap rounded-full border px-4 py-2 text-[10px] uppercase tracking-[0.2em] ${te==="polls"?"border-white/45 bg-white/10 text-white":"border-white/25 bg-black/35 text-white/80"}`,children:"Polls"}),e.jsxs("span",{className:"whitespace-nowrap rounded-full border border-cyan-300/40 bg-cyan-400/10 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-cyan-100",children:["Pulse ",Re.pct,"%"]}),e.jsxs("span",{className:"whitespace-nowrap rounded-full border border-emerald-300/40 bg-emerald-400/10 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-emerald-100",children:[ot," online"]})]}),e.jsx("aside",{className:"order-1 xl:fixed xl:top-24 xl:left-[max(1rem,calc((100vw-1700px)/2+1rem))] xl:z-30 xl:w-[340px] 2xl:w-[380px] xl:max-h-[calc(100dvh-7.5rem)] xl:overflow-y-auto",children:e.jsxs("article",{id:"link-up-composer",className:"rounded-[2rem] border border-white/15 bg-black/55 p-5 backdrop-blur-md md:p-6",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.34em] text-gold/85",children:"Link Up"}),e.jsx("h3",{className:"mt-2 font-display text-3xl",children:"Community Signal Wall"}),e.jsx("p",{className:"mt-3 text-sm text-white/70",children:"Drop moments, media links, and comments in a shared feed with other fans."}),e.jsx("p",{className:"mt-2 text-xs text-white/50",children:"Community safety: hate speech, harassment, and sexual exploitation content are blocked and can be reported."}),!n&&e.jsxs("p",{className:"mt-3 rounded-xl border border-white/15 bg-black/35 px-4 py-3 text-sm text-white/75",children:["Sign in on ",e.jsx("a",{className:"text-gold hover:text-gold/80",href:"/fan-club",children:"Fan Vault"})," to post, comment, and like."]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-xs text-white/70",children:"Post type:"}),e.jsxs("div",{className:"mt-2 grid grid-cols-1 gap-2 sm:flex sm:flex-wrap sm:items-center sm:gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{g(!1),V(!1),ne(null)},className:`min-h-11 rounded-full border px-4 py-2 text-[10px] uppercase tracking-[0.2em] ${!N&&!v?"border-gold/55 text-gold":"border-white/20 text-white/70"}`,children:"Standard"}),e.jsx("button",{type:"button",onClick:()=>{g(!0),V(!1),ne(null),S(""),A(null)},className:`min-h-11 rounded-full border px-4 py-2 text-[10px] uppercase tracking-[0.2em] ${N&&!v?"border-gold/55 text-gold":"border-white/20 text-white/70"}`,children:"Crowd Beacon Poll"}),e.jsx("button",{type:"button",onClick:()=>{V(!0),g(!1),ne(null),B(""),X(!1),o(5),R([{label:"",imageUrl:""},{label:"",imageUrl:""}])},className:`min-h-11 rounded-full border px-4 py-2 text-[10px] uppercase tracking-[0.2em] ${v?"border-gold/55 text-gold":"border-white/20 text-white/70"}`,children:"RUN IT or BUN IT"})]})]}),e.jsxs("div",{className:"mt-4 grid gap-3",children:[v?e.jsxs(e.Fragment,{children:[e.jsx("textarea",{ref:fe,value:$,onChange:t=>J(t.target.value),rows:2,placeholder:"Optional caption",className:"w-full rounded-2xl border border-white/20 bg-black/40 px-4 py-3 text-sm text-white placeholder:text-white/40"}),e.jsx("input",{value:D,onChange:t=>S(t.target.value),placeholder:"Image URL (optional if uploading)",className:"min-h-11 rounded-2xl border border-white/20 bg-black/40 px-4 py-3 text-sm text-white placeholder:text-white/40"}),e.jsxs("label",{className:"grid gap-2 rounded-2xl border border-white/20 bg-black/35 px-4 py-3 text-xs text-white/75",children:[e.jsx("span",{className:"uppercase tracking-[0.18em] text-white/55",children:"Timer (minutes)"}),e.jsx("input",{type:"range",min:ve,max:Ue,step:1,value:H,onChange:t=>o(Math.max(ve,Math.min(Ue,Number(t.target.value)||ve))),className:"w-full accent-amber-400"}),e.jsxs("span",{className:"text-gold",children:[H," minute",H===1?"":"s"]})]}),e.jsxs("div",{className:"rounded-2xl border border-white/20 bg-black/35 px-4 py-3",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-[0.2em] text-white/55",children:"Run It / Bun It Image"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/webp,image/gif,image/avif",onChange:t=>A(t.target.files?.[0]||null),className:"mt-2 block w-full text-xs text-white/75 file:mr-4 file:min-h-10 file:rounded-full file:border file:border-white/25 file:bg-black/40 file:px-4 file:py-2 file:text-[10px] file:uppercase file:tracking-[0.22em] file:text-white/85"}),y&&e.jsxs("p",{className:"mt-2 text-[11px] text-white/55",children:["Selected: ",y.name," (",(y.size/(1024*1024)).toFixed(2)," MB)"]})]})]}):N?e.jsxs(e.Fragment,{children:[e.jsx("input",{value:C,onChange:t=>B(t.target.value),placeholder:"Poll question (Crowd Beacon)",className:"min-h-11 rounded-2xl border border-white/20 bg-black/40 px-4 py-3 text-sm text-white placeholder:text-white/40"}),e.jsx("textarea",{ref:fe,value:$,onChange:t=>J(t.target.value),rows:2,placeholder:"Optional caption for this poll",className:"w-full rounded-2xl border border-white/20 bg-black/40 px-4 py-3 text-sm text-white placeholder:text-white/40"}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-xs text-white/70",children:[e.jsx("input",{type:"checkbox",checked:ee,onChange:t=>X(t.target.checked),disabled:!!T,className:"h-4 w-4 rounded border-white/30 bg-black/40"}),"Allow multiple selections"]}),e.jsxs("div",{className:"grid gap-2",children:[(T?$e:z).map((t,s)=>e.jsxs("div",{className:"rounded-2xl border border-white/20 bg-black/35 p-3",children:[e.jsxs("p",{className:"mb-2 text-[10px] uppercase tracking-[0.18em] text-white/55",children:["Option ",s+1]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("input",{value:t.label,onChange:r=>R(a=>a.map((d,c)=>c===s?{...d,label:r.target.value}:d)),disabled:!!T,placeholder:"Option label",className:"min-h-11 rounded-xl border border-white/20 bg-black/40 px-3 py-2 text-sm text-white placeholder:text-white/40"}),e.jsx("input",{value:t.imageUrl,onChange:r=>R(a=>a.map((d,c)=>c===s?{...d,imageUrl:r.target.value}:d)),disabled:!!T,placeholder:"Optional option image URL",className:"min-h-11 rounded-xl border border-white/20 bg-black/40 px-3 py-2 text-sm text-white placeholder:text-white/40"})]})]},`poll-option-${s}`)),!T&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[z.length<6&&e.jsx("button",{type:"button",onClick:()=>R(t=>[...t,{label:"",imageUrl:""}]),className:"min-h-10 rounded-full border border-white/25 px-4 py-2 text-[10px] uppercase tracking-[0.2em] text-white/70",children:"Add Option"}),z.length>2&&e.jsx("button",{type:"button",onClick:()=>R(t=>t.slice(0,-1)),className:"min-h-10 rounded-full border border-white/25 px-4 py-2 text-[10px] uppercase tracking-[0.2em] text-white/70",children:"Remove Option"})]}),T&&e.jsxs("p",{className:"text-xs text-white/55",children:["Promoter blueprint polls use fixed options: ",e.jsx("span",{className:"text-gold/90",children:"Run It"})," and ",e.jsx("span",{className:"text-gold/90",children:"Bun It"}),"."]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("textarea",{ref:fe,value:$,onChange:t=>J(t.target.value),rows:3,placeholder:"What is the energy tonight?",className:"w-full rounded-2xl border border-white/20 bg-black/40 px-4 py-3 text-sm text-white placeholder:text-white/40"}),e.jsx("input",{value:D,onChange:t=>S(t.target.value),placeholder:"Optional video/link URL (YouTube, Vimeo, etc.)",className:"min-h-11 rounded-2xl border border-white/20 bg-black/40 px-4 py-3 text-sm text-white placeholder:text-white/40"}),e.jsxs("div",{className:"rounded-2xl border border-white/20 bg-black/35 px-4 py-3",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-[0.2em] text-white/55",children:"Photo Upload"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/webp,image/gif,image/avif",onChange:t=>A(t.target.files?.[0]||null),className:"mt-2 block w-full text-xs text-white/75 file:mr-4 file:min-h-10 file:rounded-full file:border file:border-white/25 file:bg-black/40 file:px-4 file:py-2 file:text-[10px] file:uppercase file:tracking-[0.22em] file:text-white/85"}),y&&e.jsxs("p",{className:"mt-2 text-[11px] text-white/55",children:["Selected: ",y.name," (",(y.size/(1024*1024)).toFixed(2)," MB)"]})]})]}),e.jsxs("div",{className:"hidden items-center justify-between gap-3 sm:flex",children:[e.jsx("p",{className:"text-xs text-white/45",children:v?"Run It / Bun It is image-only and tracks swipe vote totals.":N?"Crowd Beacon polls support text options and optional image URLs.":"Upload photos directly. Videos are URL link based."}),e.jsx("button",{type:"button",onClick:Ve,disabled:p,className:"min-h-11 rounded-full bg-ember px-5 py-2 text-xs uppercase tracking-[0.28em] text-ink disabled:opacity-50",children:p?"Posting...":"Publish"})]}),e.jsx("p",{className:"text-xs text-white/45 sm:hidden",children:v?"Run It / Bun It is image-only and tracks swipe vote totals.":N?"Crowd Beacon polls support text options and optional image URLs.":"Upload photos directly. Videos are URL link based."}),k&&e.jsx("p",{className:"text-xs text-gold",role:"status","aria-live":"polite",children:k})]})]})}),e.jsxs("div",{className:"order-2 space-y-4 pb-28 xl:order-2 xl:ml-[360px] xl:mr-[360px] xl:pb-0 2xl:ml-[400px] 2xl:mr-[380px]",children:[e.jsxs("div",{className:"space-y-4 md:space-y-4 max-sm:max-h-[calc(100dvh-16.5rem)] max-sm:overflow-y-auto max-sm:snap-y max-sm:snap-mandatory max-sm:pr-1",children:[u&&e.jsx("div",{className:"rounded-2xl border border-white/15 bg-black/50 p-5 text-sm text-white/70",children:"Loading feed..."}),!u&&_e.length===0&&e.jsx("div",{className:"rounded-2xl border border-white/15 bg-black/50 p-5 text-sm text-white/70",children:te==="all"?"No posts yet. Be first to publish.":"No posts in this view yet."}),_e.map(t=>{const s=t.postType==="media"&&t.mediaType!=="link"&&!!t.mediaUrl;return e.jsxs("article",{id:`post-${t.id}`,className:`relative snap-start overflow-hidden rounded-[1.55rem] border border-white/15 bg-gradient-to-b from-black/60 to-black/40 p-4 shadow-[0_0_60px_rgba(242,84,45,0.08)] max-sm:min-h-[calc(100dvh-18rem)] sm:rounded-3xl sm:p-5 ${s?"max-sm:pb-2":""}`,children:[e.jsxs("div",{className:`flex items-start justify-between gap-3 ${s?"max-sm:hidden":""}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.24em] text-gold/85",children:t.authorName||"Fan"}),n&&t.userId===n.id&&e.jsx("p",{className:"mt-1 inline-flex rounded-full border border-gold/35 px-2 py-1 text-[10px] uppercase tracking-[0.18em] text-gold/90",children:Pe.current}),e.jsx("p",{className:"mt-1 text-[11px] text-white/50",children:le(t.createdAt)}),je(t.moderationStatus)&&e.jsx("p",{className:"mt-1 inline-flex rounded-full border border-amber-300/35 bg-amber-300/10 px-2 py-1 text-[10px] uppercase tracking-[0.18em] text-amber-100/90",children:je(t.moderationStatus)}),t.moderationReason&&t.moderationStatus!=="approved"&&e.jsx("p",{className:"mt-1 text-[11px] text-white/45",children:t.moderationReason})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[n&&t.userId===n.id&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>dt(t),className:"min-h-10 rounded-full border border-gold/35 px-3 py-2 text-[10px] uppercase tracking-[0.18em] text-gold/85",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>ut(t),className:"min-h-10 rounded-full border border-rose-400/35 px-3 py-2 text-[10px] uppercase tracking-[0.18em] text-rose-200/90",children:"Delete"})]}),e.jsx("button",{type:"button",onClick:()=>ct(t.id),className:"min-h-10 rounded-full border border-white/20 px-3 py-2 text-[10px] uppercase tracking-[0.18em] text-white/65",children:"Report"})]})]}),t.cleanBody&&t.postType!=="media"&&e.jsx("p",{className:"mt-4 whitespace-pre-wrap text-sm text-white/85",children:t.cleanBody}),t.postType==="blueprint"&&t.blueprint&&e.jsxs("div",{className:"mt-4 rounded-2xl border border-gold/30 bg-gold/5 p-4",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.26em] text-gold/90",children:"Promoter Blueprint"}),e.jsx("h4",{className:"mt-2 text-lg text-white",children:t.blueprint.title}),e.jsxs("div",{className:"mt-3 grid gap-2 text-xs text-white/75 sm:grid-cols-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"Stage Mode:"})," ",t.blueprint.venueType]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"City/Date:"})," ",t.blueprint.city||"TBD"," ",t.blueprint.date||""]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"Cost:"})," ",t.blueprint.estimatedCostRange]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"ROI:"})," low ",t.blueprint.roi.low,"% / exp ",t.blueprint.roi.expected,"% / high ",t.blueprint.roi.high,"%"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-white/50",children:"Risk Score:"})," ",t.blueprint.riskScore]})]}),e.jsx("a",{href:t.blueprint.shareLink,className:"mt-3 inline-flex rounded-full border border-gold/45 px-4 py-2 text-[10px] uppercase tracking-[0.2em] text-gold",children:"View Blueprint"})]}),t.postType==="trivia"&&t.poll&&e.jsx("div",{className:`mt-4 rounded-2xl border p-4 ${t.triviaMeta?.cardTone==="cyan"?"border-cyan-400/30 bg-cyan-500/5":t.triviaMeta?.cardTone==="ember"?"border-amber-300/35 bg-amber-500/5":t.triviaMeta?.cardTone==="neutral"?"border-white/20 bg-white/5":"border-gold/30 bg-gold/5"}`,children:(()=>{const r=Dt(t.triviaMeta?.accentColor||"")||"#f9b233";return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.22em]",style:{color:r},children:t.triviaMeta?.label?.trim()||"Trivia Beacon"}),e.jsx("h4",{className:"mt-2 text-lg text-white",children:t.poll.question}),e.jsxs("p",{className:"mt-1 text-xs text-white/55",children:[t.poll.allowMultiple?"Multiple choice enabled":"Single choice"," · ",t.poll.totalVotes," vote",t.poll.totalVotes===1?"":"s",t.poll.expiresAt?` · Ends ${le(t.poll.expiresAt)}`:""]}),e.jsx("div",{className:"mt-3 space-y-2",children:t.poll.options.map(a=>{const d=t.poll.totalVotes>0?Math.round(a.voteCount/t.poll.totalVotes*100):0,c=a.viewerVoted||(E[t.id]||[]).includes(a.id),x=a.imageUrl?re(a.imageUrl):null,f="w-full rounded-xl border px-3 py-2 text-left text-sm transition",L=c?"bg-black/40 text-white border-white/45":"border-white/20 bg-black/30 text-white/80 hover:border-white/45";return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{type:"button",onClick:()=>{if(t.poll){if(t.poll.allowMultiple){be(M=>{const W=M[t.id]||t.poll.options.filter(U=>U.viewerVoted).map(U=>U.id),w=W.includes(a.id)?W.filter(U=>U!==a.id):[...W,a.id];return{...M,[t.id]:w}});return}q(t,[a.id])}},className:`${f} ${L}`,style:c?{borderColor:r}:void 0,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{children:a.label}),e.jsxs("span",{className:"text-xs text-white/55",children:[a.voteCount," · ",d,"%"]})]}),x&&e.jsx("img",{src:x,alt:"",loading:"lazy",className:"mt-2 max-h-44 w-full rounded-lg object-cover"})]}),e.jsx("div",{className:"h-1.5 w-full overflow-hidden rounded-full bg-white/10",children:e.jsx("div",{className:"h-full",style:{width:`${d}%`,backgroundColor:r}})})]},a.id)})}),t.poll.allowMultiple&&e.jsx("div",{className:"mt-3 flex items-center justify-end",children:e.jsx("button",{type:"button",onClick:()=>void q(t,E[t.id]||[]),className:"min-h-10 rounded-full border px-4 py-2 text-[10px] uppercase tracking-[0.2em] text-white",style:{borderColor:r,color:r},children:"Cast Vote"})})]})})()}),t.postType==="poll"&&t.poll&&e.jsxs("div",{className:"mt-4 rounded-2xl border border-cyan-400/25 bg-cyan-500/5 p-4",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.22em] text-cyan-200/90",children:"Crowd Beacon"}),e.jsx("h4",{className:"mt-2 text-lg text-white",children:t.poll.question}),e.jsxs("p",{className:"mt-1 text-xs text-white/55",children:[t.poll.allowMultiple?"Multiple choice enabled":"Single choice"," · ",t.poll.totalVotes," vote",t.poll.totalVotes===1?"":"s",t.poll.expiresAt?` · Ends ${le(t.poll.expiresAt)}`:""]}),e.jsx("div",{className:"mt-3 space-y-2",children:t.poll.options.map(r=>{const a=t.poll.totalVotes>0?Math.round(r.voteCount/t.poll.totalVotes*100):0,d=r.viewerVoted||(E[t.id]||[]).includes(r.id),c=r.imageUrl?re(r.imageUrl):null,x="w-full rounded-xl border px-3 py-2 text-left text-sm transition",f=d?"border-cyan-300/60 bg-cyan-300/10 text-cyan-100":"border-white/20 bg-black/30 text-white/80 hover:border-white/45";return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{type:"button",onClick:()=>{if(t.poll){if(t.poll.allowMultiple){be(L=>{const M=L[t.id]||t.poll.options.filter(w=>w.viewerVoted).map(w=>w.id),G=M.includes(r.id)?M.filter(w=>w!==r.id):[...M,r.id];return{...L,[t.id]:G}});return}q(t,[r.id])}},className:`${x} ${f}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{children:r.label}),e.jsxs("span",{className:"text-xs text-white/55",children:[r.voteCount," · ",a,"%"]})]}),c&&e.jsx("img",{src:c,alt:"",loading:"lazy",className:"mt-2 max-h-44 w-full rounded-lg object-cover"})]}),e.jsx("div",{className:"h-1.5 w-full overflow-hidden rounded-full bg-white/10",children:e.jsx("div",{className:"h-full bg-cyan-300/70",style:{width:`${a}%`}})})]},r.id)})}),t.poll.allowMultiple&&e.jsx("div",{className:"mt-3 flex items-center justify-end",children:e.jsx("button",{type:"button",onClick:()=>void q(t,E[t.id]||[]),className:"min-h-10 rounded-full border border-cyan-300/50 px-4 py-2 text-[10px] uppercase tracking-[0.2em] text-cyan-100",children:"Cast Vote"})})]}),t.postType==="runbun"&&t.poll&&e.jsx("div",{className:"mt-4 rounded-2xl border border-gold/30 bg-gold/5 p-4",children:(()=>{const r=t.poll.options.find(j=>nt(j.label)==="run it"),a=t.poll.options.find(j=>nt(j.label)==="bun it"),d=r?.voteCount||0,c=a?.voteCount||0,x=Math.max(1,d+c),f=Math.round(d/x*100),L=Math.round(c/x*100),M=t.mediaUrl?re(t.mediaUrl):null,W=t.poll?.expiresAt?Date.parse(t.poll.expiresAt):NaN,G=Number.isFinite(W),w=G?Math.max(0,W-lt):0,U=G?w<=0:!1,Je=j=>{if(!U&&!(Math.abs(j)<Bt)){if(j>0&&r){q(t,[r.id]);return}j<0&&a&&q(t,[a.id])}};return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.22em] text-gold/90",children:"Run It / Bun It"}),e.jsxs("p",{className:"mt-1 text-xs text-white/60",children:[U?"Voting closed.":"Swipe right to Run It. Swipe left to Bun It.",t.poll?.expiresAt?` Ends ${le(t.poll.expiresAt)}.`:""]}),e.jsx("div",{className:"mt-2 inline-flex items-center rounded-full border border-gold/35 bg-black/45 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-gold/90",children:G?`Countdown ${_t(w)}`:"No timer"}),e.jsxs("div",{className:"relative mt-3 overflow-hidden rounded-2xl border border-white/15 bg-black/35",onTouchStart:j=>{ge.current[t.id]=j.changedTouches[0]?.clientX||0},onTouchEnd:j=>{const ye=ge.current[t.id]||0,ht=j.changedTouches[0]?.clientX||ye;Je(ht-ye)},onMouseDown:j=>{ge.current[t.id]=j.clientX},onMouseUp:j=>{const ye=ge.current[t.id]||j.clientX;Je(j.clientX-ye)},children:[M?e.jsx("img",{src:M,alt:"",loading:"lazy",className:"max-h-[34rem] w-full object-cover"}):e.jsx("p",{className:"px-4 py-3 text-sm text-white/55",children:"Run It / Bun It requires a safe image URL."}),U&&e.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-orange-700/70 via-amber-500/35 to-transparent animate-pulse"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-2/5 bg-[radial-gradient(circle_at_10%_100%,rgba(255,120,0,0.85),transparent_40%),radial-gradient(circle_at_35%_100%,rgba(255,180,0,0.8),transparent_45%),radial-gradient(circle_at_60%_100%,rgba(255,90,0,0.8),transparent_42%),radial-gradient(circle_at_85%_100%,rgba(255,170,0,0.75),transparent_44%)] opacity-90 animate-pulse"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"rounded-2xl border border-amber-300/60 bg-black/65 px-8 py-4 text-3xl font-semibold uppercase tracking-[0.24em] text-amber-200 shadow-[0_0_30px_rgba(255,140,0,0.55)]",children:"BUN UP!"})})]}),e.jsxs("div",{className:"pointer-events-none absolute inset-0 flex items-end justify-between p-3 text-[10px] uppercase tracking-[0.2em]",children:[e.jsx("span",{className:"rounded-full border border-gold/40 bg-black/55 px-3 py-1 text-gold",children:"Run It →"}),e.jsx("span",{className:"rounded-full border border-rose-300/35 bg-black/55 px-3 py-1 text-rose-200",children:"← Bun It"})]})]}),e.jsxs("div",{className:"mt-3 grid gap-2 sm:grid-cols-2",children:[e.jsxs("button",{type:"button",disabled:!r||U,onClick:()=>r&&void q(t,[r.id]),className:"min-h-11 rounded-xl border border-gold/40 bg-black/35 px-4 py-2 text-left text-sm text-gold disabled:opacity-50",children:["Run It · ",d," (",f,"%)"]}),e.jsxs("button",{type:"button",disabled:!a||U,onClick:()=>a&&void q(t,[a.id]),className:"min-h-11 rounded-xl border border-rose-300/35 bg-black/35 px-4 py-2 text-left text-sm text-rose-200 disabled:opacity-50",children:["Bun It · ",c," (",L,"%)"]})]})]})})()}),t.mediaUrl&&t.postType!=="runbun"&&e.jsxs("div",{className:`relative mt-4 overflow-hidden rounded-2xl border bg-black/40 ${t.postType==="media"?"border-gold/30 shadow-[0_0_32px_rgba(243,211,139,0.12)]":"border-white/15"} ${s?"max-sm:-mx-4 max-sm:rounded-none max-sm:border-x-0 max-sm:border-b-0":""}`,children:[t.mediaType==="image"&&(()=>{const r=re(t.mediaUrl||"");return r?e.jsx("img",{src:r,alt:"",loading:"lazy",className:`w-full object-cover ${t.postType==="media"?"max-h-[72dvh] max-sm:h-[72dvh]":"max-h-[34rem]"}`}):e.jsx("p",{className:"px-4 py-3 text-sm text-white/55",children:"Blocked unsafe image URL."})})(),t.mediaType==="video"&&(()=>{const r=re(t.mediaUrl||"");if(!r)return e.jsx("p",{className:"px-4 py-3 text-sm text-white/55",children:"Blocked unsafe video URL."});const a=At(r);return a?e.jsx("iframe",{src:a,title:"Shared fan video",className:`w-full ${s?"max-sm:h-[72dvh]":"aspect-video"}`,allow:"autoplay; encrypted-media; picture-in-picture; web-share",loading:"lazy"}):e.jsx("a",{href:r,target:"_blank",rel:"noreferrer noopener",className:"block px-4 py-3 text-sm text-gold hover:text-gold/80",children:"Open video link"})})(),t.mediaType==="link"&&(()=>{const r=re(t.mediaUrl||"");return r?e.jsx("a",{href:r,target:"_blank",rel:"noreferrer noopener",className:"block px-4 py-3 text-sm text-gold hover:text-gold/80",children:"Open shared link"}):e.jsx("p",{className:"px-4 py-3 text-sm text-white/55",children:"Blocked unsafe link URL."})})(),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pointer-events-none absolute inset-x-0 bottom-0 h-44 bg-gradient-to-t from-black via-black/65 to-transparent sm:hidden"}),e.jsxs("div",{className:"pointer-events-none absolute bottom-0 left-0 right-0 z-10 p-3 sm:hidden",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border border-white/25 bg-black/55 px-3 py-1 text-[9px] uppercase tracking-[0.2em] text-white/75 animate-pulse",children:[e.jsx("span",{children:"Swipe"}),e.jsx("span",{className:"text-white/45",children:"|"}),e.jsx("span",{children:"Next Drop"})]}),e.jsx("p",{className:"mt-3 text-[10px] uppercase tracking-[0.22em] text-gold/90",children:t.authorName||"Fan"}),e.jsx("p",{className:"mt-1 text-[11px] text-white/55",children:le(t.createdAt)}),t.cleanBody&&e.jsx("p",{className:"mt-2 max-w-[95%] text-sm leading-5 text-white/92",children:t.cleanBody})]})]})]}),e.jsxs("div",{className:"absolute right-3 top-[4.2rem] z-20 flex flex-col gap-2 sm:hidden",children:[e.jsx("button",{type:"button",onClick:()=>Xe(t.id),className:`min-h-11 min-w-11 rounded-full border bg-black/70 px-2 text-[11px] font-medium backdrop-blur-lg ${t.viewerHasLiked?"border-gold/70 text-gold":"border-white/30 text-white/85"}`,children:t.likeCount}),e.jsx("button",{type:"button",onClick:()=>We(t.id),className:"min-h-11 min-w-11 rounded-full border border-white/30 bg-black/70 px-2 text-[11px] font-medium text-white/85 backdrop-blur-lg",children:t.comments.length}),e.jsx("button",{type:"button",onClick:()=>Ye(t),className:"min-h-11 min-w-11 rounded-full border border-white/30 bg-black/70 px-2 text-[10px] uppercase tracking-[0.15em] text-white/85 backdrop-blur-lg",children:"Share"})]}),t.cleanBody&&t.postType==="media"&&!s&&e.jsx("p",{className:"mt-4 whitespace-pre-wrap text-sm text-white/90",children:t.cleanBody}),e.jsxs("div",{className:"mt-4 hidden grid-cols-3 gap-2 text-[11px] uppercase tracking-[0.19em] sm:flex sm:flex-wrap sm:items-center sm:text-xs sm:tracking-[0.22em]",children:[e.jsxs("button",{type:"button",onClick:()=>Xe(t.id),className:`min-h-11 rounded-full border px-4 py-2 transition ${t.viewerHasLiked?"border-gold/60 text-gold":"border-white/20 text-white/70 hover:border-white/45 hover:text-white"}`,children:["Like ",t.likeCount]}),e.jsxs("button",{type:"button",onClick:()=>Ye(t),className:"min-h-11 rounded-full border border-white/20 px-4 py-2 text-white/70 transition hover:border-white/45 hover:text-white",children:["Share ",t.shareCount]}),e.jsxs("button",{type:"button",onClick:()=>We(t.id),className:"min-h-11 rounded-full border border-white/20 px-4 py-2 text-white/70 transition hover:border-white/45 hover:text-white",children:["Comments ",t.comments.length]})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[(ie[t.id]?t.comments:t.comments.slice(0,2)).map(r=>e.jsxs("div",{className:"rounded-2xl border border-white/12 bg-black/35 px-4 py-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] uppercase tracking-[0.2em] text-white/50",children:r.authorName||"Fan"}),je(r.moderationStatus)&&e.jsx("p",{className:"mt-1 inline-flex rounded-full border border-amber-300/35 bg-amber-300/10 px-2 py-1 text-[10px] uppercase tracking-[0.18em] text-amber-100/90",children:je(r.moderationStatus)})]}),e.jsx("button",{type:"button",onClick:()=>mt(r.id),className:"min-h-9 rounded-full border border-white/20 px-3 py-1 text-[10px] uppercase tracking-[0.18em] text-white/65",children:"Report"})]}),e.jsx("p",{className:"mt-1 text-sm text-white/80",children:r.body}),r.moderationReason&&r.moderationStatus!=="approved"&&e.jsx("p",{className:"mt-1 text-[11px] text-white/45",children:r.moderationReason}),e.jsx("p",{className:"mt-1 text-[11px] text-white/40",children:le(r.createdAt)})]},r.id)),t.comments.length>2&&e.jsx("button",{type:"button",onClick:()=>pe(r=>({...r,[t.id]:!r[t.id]})),className:"min-h-10 rounded-full border border-white/20 px-4 py-2 text-[10px] uppercase tracking-[0.2em] text-white/70",children:ie[t.id]?"Show fewer comments":`View all ${t.comments.length} comments`})]}),e.jsxs("div",{className:"mt-4 hidden items-center gap-2 sm:flex",children:[e.jsx("input",{ref:r=>{Ie.current[t.id]=r},value:ae[t.id]||"",onChange:r=>_(a=>({...a,[t.id]:r.target.value})),placeholder:"Write a comment...",className:"min-h-11 flex-1 rounded-full border border-white/20 bg-black/35 px-4 py-2 text-sm text-white placeholder:text-white/40"}),e.jsx("button",{type:"button",onClick:()=>ze(t.id),className:"min-h-11 rounded-full border border-gold/40 px-4 py-2 text-xs uppercase tracking-[0.22em] text-gold hover:bg-gold/10",children:"Send"})]})]},t.id)})]}),k&&e.jsx("p",{className:"text-xs text-gold",children:k})]}),e.jsx("aside",{className:"order-3 xl:fixed xl:top-24 xl:right-[max(1rem,calc((100vw-1700px)/2+1rem))] xl:z-30 xl:w-[340px] 2xl:w-[360px] xl:max-h-[calc(100dvh-7.5rem)] xl:overflow-y-auto",children:e.jsx(Rt,{energy:Re.pct,trend:Re.trend,activeFans:de,citySignals:he,weeklyPrompt:De,rankLabel:Pe.current,xp:oe.xp,progressPct:Pe.progress,onUsePrompt:xt,onDropAttend:pt,inline:!0})}),!P&&e.jsx("button",{type:"button",onClick:Be,className:"fixed bottom-[6.25rem] right-4 z-40 min-h-11 rounded-full border border-gold/40 bg-black/85 px-4 py-2 text-[10px] uppercase tracking-[0.22em] text-gold backdrop-blur-xl sm:hidden",children:"Jump to Composer"}),e.jsx("div",{className:"fixed inset-x-0 bottom-0 z-40 px-4 pb-[calc(env(safe-area-inset-bottom)+0.75rem)] sm:hidden",children:e.jsx("div",{className:"rounded-2xl border border-white/20 bg-black/80 px-4 py-3 backdrop-blur-xl",children:P?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.24em] text-white/60",children:"Comment Mode"}),e.jsx("button",{type:"button",onClick:()=>Q(null),className:"min-h-9 rounded-full border border-white/25 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-white/70",children:"Close"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:t=>{P&&(Ie.current[P]=t)},value:ae[P]||"",onChange:t=>_(s=>({...s,[P]:t.target.value})),placeholder:"Write a comment...",className:"min-h-11 flex-1 rounded-full border border-white/20 bg-black/35 px-4 py-2 text-sm text-white placeholder:text-white/40"}),e.jsx("button",{type:"button",onClick:()=>ze(P),className:"min-h-11 rounded-full border border-gold/40 px-4 py-2 text-xs uppercase tracking-[0.22em] text-gold",children:"Send"})]})]}):e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.24em] text-white/60",children:v?"Run It / Bun It":N?"Crowd Beacon Poll":"Standard Post"}),e.jsx("p",{className:"text-xs text-white/75",children:Oe?"Ready to publish":v?"Add a photo or image URL":N?"Add question + 2 options":"Add text, photo, or link"})]}),e.jsx("button",{type:"button",onClick:Ve,disabled:p,className:"min-h-11 rounded-full bg-ember px-5 py-2 text-xs uppercase tracking-[0.26em] text-ink disabled:opacity-50",children:p?"Posting...":"Publish"})]})})})]})}export{Wt as default};
