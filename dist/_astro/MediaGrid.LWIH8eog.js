import{j as e}from"./jsx-runtime.TBa3i5EZ.js";import{r as l}from"./index.CVf8TyFT.js";import{g as $}from"./fanVault.BDzHPXqn.js";import T from"./FavoriteButton.CB9zf3qM.js";import"./index.BtUICepX.js";const A="the-performa-gallery-lightbox-social-v1",E=()=>{try{return JSON.parse(localStorage.getItem(A)||"{}")}catch{return{}}},_=s=>{localStorage.setItem(A,JSON.stringify(s))},I=()=>({reactions:{like:0,celebrate:0,support:0},userReaction:null,comments:[]}),z=s=>({...s,comments:(s.comments||[]).map(i=>({text:i?.text||"",createdAt:i?.createdAt||new Date().toISOString(),userId:i?.userId||"legacy",userName:i?.userName||"Fan",userEmail:i?.userEmail||""})).filter(i=>i.text.trim().length>0)});function D(){return e.jsxs("svg",{viewBox:"0 0 24 24","aria-hidden":"true",className:"h-4 w-4",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M10 21H5a2 2 0 0 1-2-2v-6a2 2 0 0 1 2-2h5"}),e.jsx("path",{d:"M10 11l3-8a2 2 0 0 1 3 1v7h4a2 2 0 0 1 2 2l-1 6a2 2 0 0 1-2 2H10z"})]})}function P(){return e.jsxs("svg",{viewBox:"0 0 24 24","aria-hidden":"true",className:"h-4 w-4",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M5 14l7-7 7 7"}),e.jsx("path",{d:"M12 7v13"}),e.jsx("path",{d:"M4 4l2 2M20 4l-2 2M2 10h3M19 10h3"})]})}function B(){return e.jsxs("svg",{viewBox:"0 0 24 24","aria-hidden":"true",className:"h-4 w-4",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M8 12v6"}),e.jsx("path",{d:"M16 12v6"}),e.jsx("path",{d:"M5 21h14"}),e.jsx("path",{d:"M8 12l-2-2M16 12l2-2"}),e.jsx("path",{d:"M10 9l2-2 2 2"})]})}function O(){return e.jsx("svg",{viewBox:"0 0 24 24","aria-hidden":"true",className:"h-4 w-4",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M21 11a8 8 0 0 1-8 8H8l-5 3 2-5a8 8 0 1 1 16-6z"})})}function G(){return e.jsxs("svg",{viewBox:"0 0 24 24","aria-hidden":"true",className:"h-4 w-4",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 3h7v7"}),e.jsx("path",{d:"M10 14L21 3"}),e.jsx("path",{d:"M21 14v5a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5"})]})}function f({label:s,icon:i,burst:c,burstClass:b,className:d="",active:a=!1,tick:u,onClick:r}){return e.jsxs("button",{type:"button",onClick:r,className:`fb-bar-btn ${a?"fb-bar-btn-active":""} ${d}`,children:[e.jsx("span",{className:"fb-bar-icon",children:i},u),e.jsx("span",{children:s}),u>0&&e.jsx("span",{className:`fb-click-burst ${b}`,"aria-hidden":"true",children:c},`burst-${u}`)]})}function U({items:s,index:i,onClose:c}){const[b,d]=l.useState(i),[a,u]=l.useState(I()),[r,h]=l.useState(null),[w,k]=l.useState(""),[j,p]=l.useState(""),[g,v]=l.useState({like:0,celebrate:0,support:0,comment:0,share:0}),C=l.useRef(null);l.useEffect(()=>{const t=document.body.style.overflow;document.body.style.overflow="hidden";const o=n=>{n.key==="Escape"&&c(),n.key==="ArrowRight"&&d(m=>(m+1)%s.length),n.key==="ArrowLeft"&&d(m=>(m-1+s.length)%s.length)};return window.addEventListener("keydown",o),()=>{document.body.style.overflow=t,window.removeEventListener("keydown",o)}},[s.length,c]),l.useEffect(()=>{const t=()=>{$().then(h)};return t(),window.addEventListener("fanvault:changed",t),()=>window.removeEventListener("fanvault:changed",t)},[]);const x=s[b],y=x.image;l.useEffect(()=>{const t=E();u(z(t[y]||I())),k("")},[y]),l.useEffect(()=>{if(!j)return;const t=window.setTimeout(()=>p(""),1800);return()=>window.clearTimeout(t)},[j]);const S=t=>{u(t);const o=E();o[y]=t,_(o)},N=t=>{const o=a.userReaction,n=o===t?null:t,m={...a.reactions};o&&(m[o]=Math.max(0,m[o]-1)),n&&(m[n]=m[n]+1),S({...a,reactions:m,userReaction:n}),v(L=>({...L,[t]:L[t]+1})),p(n?"Reaction added":"Reaction removed")},R=async()=>{try{const t=`${window.location.origin}/gallery?utm_source=fan-share&utm_medium=social&utm_campaign=gallery_clip&utm_content=${encodeURIComponent(x.alt||"gallery-moment")}`,o={title:"The Performa Gallery",text:x.alt||"Gallery moment",url:t};navigator.share?await navigator.share(o):await navigator.clipboard.writeText(t),v(n=>({...n,share:n.share+1})),p("Shared")}catch{p("Share cancelled")}},M=()=>{const t=w.trim();if(!t)return;if(!r){p("Log in to Fan Vault to comment");return}const o=[{text:t,createdAt:new Date().toISOString(),userId:r.id,userName:r.name||"Fan",userEmail:r.email||""},...a.comments].slice(0,20);S({...a,comments:o}),k(""),v(n=>({...n,comment:n.comment+1})),p("Comment added")};return e.jsxs("div",{className:"fixed inset-0 z-[120] flex items-start justify-center overflow-y-auto bg-black/90 p-3 md:items-center md:p-6",onClick:c,onMouseDown:c,role:"dialog","aria-modal":"true","aria-label":"Gallery image viewer",children:[e.jsx("button",{type:"button",onClick:c,onMouseDown:t=>t.stopPropagation(),className:"absolute right-3 top-[max(0.8rem,env(safe-area-inset-top))] z-[130] rounded-full border border-white/25 bg-black/60 px-3 py-2 text-[10px] uppercase tracking-[0.22em] text-white/80 hover:text-white md:right-6 md:top-6 md:border-0 md:bg-transparent md:px-0 md:py-0 md:text-xs md:tracking-[0.3em]",children:"Close"}),e.jsx("button",{type:"button",onClick:()=>d(t=>(t-1+s.length)%s.length),onMouseDown:t=>t.stopPropagation(),className:"absolute left-2 top-1/2 z-[130] -translate-y-1/2 rounded-full border border-white/20 bg-black/55 px-2 py-1 text-xl text-white/70 hover:text-white md:left-6 md:border-0 md:bg-transparent md:px-0 md:py-0 md:text-2xl","aria-label":"Previous",children:"<"}),e.jsxs("div",{className:"my-8 w-full max-w-4xl",onClick:t=>t.stopPropagation(),onMouseDown:t=>t.stopPropagation(),children:[e.jsx("img",{src:x.image,alt:x.alt,className:"max-h-[46vh] w-full object-contain md:max-h-[62vh]"}),e.jsxs("div",{className:"mt-4 rounded-2xl border border-white/15 bg-black/50 p-4 text-center",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-white/60",children:x.tags.join(" · ")}),x.credit&&e.jsx("p",{className:"mt-2 text-xs text-white/50",children:x.credit}),e.jsxs("div",{className:"mx-auto mt-4 max-w-2xl rounded-xl border border-white/15 bg-black/55 text-left",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-white/10 px-3 py-2 text-[11px] text-white/60",children:[e.jsxs("span",{children:["Like ",a.reactions.like," · Celebrate ",a.reactions.celebrate," · Support ",a.reactions.support]}),e.jsxs("span",{children:[a.comments.length," comments"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5",children:[e.jsx(f,{label:"Like",icon:e.jsx(D,{}),burst:"+1",burstClass:"fb-burst-like",tick:g.like,active:a.userReaction==="like",className:"border-r border-white/10",onClick:()=>N("like")}),e.jsx(f,{label:"Celebrate",icon:e.jsx(P,{}),burst:"***",burstClass:"fb-burst-celebrate",tick:g.celebrate,active:a.userReaction==="celebrate",className:"border-r border-white/10",onClick:()=>N("celebrate")}),e.jsx(f,{label:"Support",icon:e.jsx(B,{}),burst:"OK",burstClass:"fb-burst-support",tick:g.support,active:a.userReaction==="support",className:"border-r border-white/10",onClick:()=>N("support")}),e.jsx(f,{label:"Comment",icon:e.jsx(O,{}),burst:"C",burstClass:"fb-burst-comment",tick:g.comment,className:"border-r border-white/10",onClick:()=>{v(t=>({...t,comment:t.comment+1})),C.current?.focus()}}),e.jsx(f,{label:"Share",icon:e.jsx(G,{}),burst:">",burstClass:"fb-burst-share",tick:g.share,className:"text-[#1877f2]",onClick:()=>void R()})]})]}),e.jsxs("div",{className:"mx-auto mt-4 max-w-2xl rounded-xl border border-white/10 bg-black/50 p-3 text-left",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.24em] text-white/55",children:"Comments"}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("input",{ref:C,value:w,onChange:t=>k(t.target.value),onKeyDown:t=>{t.key==="Enter"&&M()},placeholder:"Add a comment...",className:"w-full rounded-full border border-white/20 bg-black/40 px-3 py-2 text-xs text-white/85 placeholder:text-white/35"}),e.jsx("button",{type:"button",onClick:M,disabled:!r,className:"rounded-full border border-white/30 px-3 py-2 text-[10px] uppercase tracking-[0.2em] text-white/75",children:"Post"})]}),!r&&e.jsx("p",{className:"mt-2 text-[11px] text-white/55",children:"Log in to Fan Vault to post comments."}),e.jsxs("ul",{className:"mt-3 max-h-56 space-y-2 overflow-y-auto pr-1",children:[a.comments.map((t,o)=>e.jsxs("li",{className:"rounded-xl border border-white/10 bg-black/35 px-3 py-2 text-xs text-white/75",children:[e.jsxs("p",{className:"text-[10px] uppercase tracking-[0.14em] text-white/55",children:[t.userName,t.userEmail?` · ${t.userEmail}`:""]}),e.jsx("p",{className:"mt-1",children:t.text})]},`${t.createdAt}-${o}`)),!a.comments.length&&e.jsx("li",{className:"text-xs text-white/45",children:"No comments yet."})]})]}),j&&e.jsx("p",{className:"mt-3 text-xs text-gold",children:j})]})]}),e.jsx("button",{type:"button",onClick:()=>d(t=>(t+1)%s.length),onMouseDown:t=>t.stopPropagation(),className:"absolute right-2 top-1/2 z-[130] -translate-y-1/2 rounded-full border border-white/20 bg-black/55 px-2 py-1 text-xl text-white/70 hover:text-white md:right-6 md:border-0 md:bg-transparent md:px-0 md:py-0 md:text-2xl","aria-label":"Next",children:">"})]})}function J({items:s}){const i=l.useMemo(()=>{const r=new Set;return s.forEach(h=>h.tags.forEach(w=>r.add(w))),["All",...Array.from(r)]},[s]),[c,b]=l.useState("All"),[d,a]=l.useState(null),u=l.useMemo(()=>c==="All"?s:s.filter(r=>r.tags.includes(c)),[c,s]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap gap-3 text-xs uppercase tracking-[0.3em]",children:i.map(r=>e.jsx("button",{type:"button",onClick:()=>b(r),className:`rounded-full border px-4 py-2 transition ${c===r?"border-ember text-white":"border-white/20 text-white/60 hover:border-white/50"}`,children:r},r))}),e.jsx("div",{className:"columns-1 gap-4 md:columns-2 lg:columns-3",children:u.map((r,h)=>e.jsxs("article",{className:"group relative mb-4 w-full break-inside-avoid overflow-hidden rounded-2xl border border-white/15 bg-black/40 text-left shadow-[0_0_60px_rgba(242,84,45,0.08)]",children:[e.jsx("div",{className:"absolute right-3 top-3 z-20",children:e.jsx(T,{type:"gallery",itemId:r.image,title:r.alt||"Gallery moment",href:"/gallery",image:r.image,compact:!0})}),e.jsxs("button",{type:"button",onClick:()=>a(h),className:"w-full text-left",children:[e.jsx("img",{src:r.image,alt:r.alt,loading:"lazy",className:"w-full object-cover transition duration-500 group-hover:scale-[1.02]"}),e.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(180deg,rgba(0,0,0,0)_45%,rgba(0,0,0,0.78)_100%)]"}),e.jsxs("div",{className:"relative p-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-white/60",children:r.tags.join(" � ")}),r.credit&&e.jsx("p",{className:"mt-2 text-xs text-white/50",children:r.credit})]})]})]},`${r.image}-${h}`))}),d!==null&&e.jsx(U,{items:u,index:d,onClose:()=>a(null)})]})}export{J as default};
