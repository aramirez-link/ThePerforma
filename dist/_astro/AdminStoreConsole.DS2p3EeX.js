import{j as t}from"./jsx-runtime.TBa3i5EZ.js";import{r as i}from"./index.CVf8TyFT.js";import{g as T,a as D,s as _,L as K,f as j,u as C,l as W,b as q,i as H,c as z,d as G,e as J,h as Q,r as X}from"./storefront.CQ1BUduJ.js";import"./index.BtUICepX.js";const S={name:"",slug:"",description:"",product_type:"physical",status:"draft",base_price_cents:0,currency:"usd",cover_image:""};function se(){const[N,A]=i.useState(""),[d,n]=i.useState(""),[h,x]=i.useState(!1),[P,I]=i.useState(!0),[L,O]=i.useState(!1),[w,M]=i.useState(""),[l,R]=i.useState({products:[],variants:[],orders:[],orderItems:[],reviews:[]}),[a,c]=i.useState(S),[r,o]=i.useState({product_id:"",sku:"",title:"",price_cents:0,inventory_mode:"unlimited",inventory_count:0,digital_delivery_url:"",is_default:!1}),[b,E]=i.useState(""),u=async()=>{const e=await W();if(!e.ok){n(e.error);return}R(e.data)};i.useEffect(()=>{const e=async()=>{const m=await q();M(m?.email||"");const f=await H();O(f),f&&await u(),I(!1)};e();const p=T()?.auth.onAuthStateChange(()=>{e()});return()=>p?.data.subscription.unsubscribe()},[]),i.useEffect(()=>{if(!d)return;const e=window.setTimeout(()=>n(""),3e3);return()=>window.clearTimeout(e)},[d]);const k=i.useMemo(()=>{const e=new Map;return l.products.forEach(s=>e.set(s.id,s)),e},[l.products]),v=l.variants.filter(e=>e.product_id===b),V=i.useMemo(()=>{const e=new Map;for(const s of l.orderItems){const p=e.get(s.order_id)||[];p.push(s),e.set(s.order_id,p)}return e},[l.orderItems]),y=i.useMemo(()=>l.variants.map(e=>{const s=D(e);return{variant:e,stock:s,product:k.get(e.product_id)||null}}).filter(e=>e.variant.inventory_mode==="finite"&&(e.stock.outOfStock||e.stock.lowStock)).sort((e,s)=>(e.stock.remaining??9999)-(s.stock.remaining??9999)),[k,l.variants]),U=async()=>{x(!0);const e=await z(N);x(!1),n(e.ok?"Check your email for the magic link.":e.error)},$=async e=>{const s=await G(e);s.ok||n(s.error)},B=async()=>{if(!a.name||!a.slug){n("Name and slug are required.");return}x(!0);const e=await J({name:a.name,slug:a.slug,description:a.description,product_type:a.product_type,status:a.status,base_price_cents:Number(a.base_price_cents||0),currency:a.currency,cover_image:a.cover_image||null});if(x(!1),!e.ok){n(e.error);return}n("Product saved."),c(S),await u()},F=async()=>{if(!r.product_id||!r.sku||!r.title){n("Pick product + add SKU and title.");return}x(!0);const e=await Q({product_id:r.product_id,sku:r.sku,title:r.title,price_cents:Number(r.price_cents||0),inventory_mode:r.inventory_mode,inventory_count:r.inventory_mode==="finite"?Number(r.inventory_count||0):null,digital_delivery_url:r.digital_delivery_url||null,is_default:r.is_default});if(x(!1),!e.ok){n(e.error);return}n("Variant saved."),o({product_id:r.product_id,sku:"",title:"",price_cents:0,inventory_mode:"unlimited",inventory_count:0,digital_delivery_url:"",is_default:!1}),await u()},g=async(e,s)=>{const p=s==="mark_shipped"&&window.prompt("Tracking number (optional):","")||"",m=await X({orderId:e,action:s,trackingNumber:p||void 0});n(m.ok?`Order ${s.replace("_"," ")} complete.`:m.error),m.ok&&await u()};return P?t.jsx("section",{className:"mx-auto w-full max-w-6xl px-4 pb-20 pt-8 sm:px-6",children:t.jsx("div",{className:"rounded-3xl border border-white/15 bg-black/45 p-6",children:t.jsx("p",{className:"text-sm text-white/70",children:"Loading admin console..."})})}):w?L?t.jsxs("section",{className:"mx-auto w-full max-w-6xl px-4 pb-20 pt-8 sm:px-6",children:[t.jsx("div",{className:"rounded-3xl border border-white/15 bg-black/45 p-6",children:t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gold/80",children:"Store Admin"}),t.jsx("h1",{className:"mt-2 font-display text-3xl",children:"Commerce Control"}),t.jsx("p",{className:"mt-1 text-sm text-white/70",children:w})]}),t.jsx("button",{type:"button",onClick:async()=>{await _(),window.location.reload()},className:"min-h-11 rounded-full border border-white/30 px-5 py-2 text-xs uppercase tracking-[0.24em] text-white/80",children:"Sign out"})]})}),t.jsxs("div",{className:"mt-5 grid gap-4 lg:grid-cols-2",children:[t.jsxs("article",{className:"rounded-3xl border border-white/15 bg-black/35 p-5 lg:col-span-2",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.24em] text-white/55",children:"Inventory Alerts"}),t.jsxs("p",{className:"mt-1 text-xs text-white/55",children:["Low stock threshold: ",K]}),t.jsxs("div",{className:"mt-3 grid gap-2 sm:grid-cols-2",children:[y.slice(0,12).map(e=>t.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/20 p-3",children:[t.jsx("p",{className:"text-sm text-white/90",children:e.product?.name||"Unknown product"}),t.jsxs("p",{className:"text-xs text-white/65",children:[e.variant.title," (",e.variant.sku,")"]}),t.jsx("p",{className:`mt-1 text-xs ${e.stock.outOfStock?"text-rose-300":"text-gold"}`,children:e.stock.outOfStock?"Out of stock":`Low stock: ${e.stock.remaining} left`})]},e.variant.id)),!y.length&&t.jsx("p",{className:"text-sm text-white/60",children:"No low-stock or out-of-stock alerts."})]})]}),t.jsxs("article",{className:"rounded-3xl border border-white/15 bg-black/35 p-5",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.24em] text-white/55",children:"Create Product"}),t.jsxs("div",{className:"mt-3 grid gap-2",children:[t.jsx("input",{value:a.name,onChange:e=>c(s=>({...s,name:e.target.value})),placeholder:"Name",className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsx("input",{value:a.slug,onChange:e=>c(s=>({...s,slug:e.target.value.toLowerCase().replace(/\s+/g,"-")})),placeholder:"slug",className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsx("textarea",{value:a.description,onChange:e=>c(s=>({...s,description:e.target.value})),rows:3,placeholder:"Description",className:"rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[t.jsx("select",{value:a.product_type,onChange:e=>c(s=>({...s,product_type:e.target.value})),className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm",children:["physical","digital_tool","digital_download","subscription","bundle"].map(e=>t.jsx("option",{value:e,children:e},e))}),t.jsx("select",{value:a.status,onChange:e=>c(s=>({...s,status:e.target.value})),className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm",children:["draft","active","archived"].map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[t.jsx("input",{type:"number",min:0,value:a.base_price_cents,onChange:e=>c(s=>({...s,base_price_cents:Number(e.target.value)})),placeholder:"Base price (cents)",className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsx("input",{value:a.currency,onChange:e=>c(s=>({...s,currency:e.target.value})),placeholder:"Currency (usd)",className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"})]}),t.jsx("input",{value:a.cover_image,onChange:e=>c(s=>({...s,cover_image:e.target.value})),placeholder:"Cover image URL",className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsx("button",{type:"button",onClick:B,disabled:h,className:"min-h-11 rounded-full bg-ember px-5 py-2 text-[11px] uppercase tracking-[0.22em] text-ink",children:"Save Product"})]})]}),t.jsxs("article",{className:"rounded-3xl border border-white/15 bg-black/35 p-5",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.24em] text-white/55",children:"Create Variant"}),t.jsxs("div",{className:"mt-3 grid gap-2",children:[t.jsxs("select",{value:r.product_id,onChange:e=>o(s=>({...s,product_id:e.target.value})),className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm",children:[t.jsx("option",{value:"",children:"Select product"}),l.products.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsx("input",{value:r.sku,onChange:e=>o(s=>({...s,sku:e.target.value})),placeholder:"SKU",className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsx("input",{value:r.title,onChange:e=>o(s=>({...s,title:e.target.value})),placeholder:"Variant title",className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsx("input",{type:"number",min:0,value:r.price_cents,onChange:e=>o(s=>({...s,price_cents:Number(e.target.value)})),placeholder:"Price (cents)",className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsxs("select",{value:r.inventory_mode,onChange:e=>o(s=>({...s,inventory_mode:e.target.value})),className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm",children:[t.jsx("option",{value:"unlimited",children:"unlimited"}),t.jsx("option",{value:"finite",children:"finite"})]}),r.inventory_mode==="finite"&&t.jsx("input",{type:"number",min:0,value:r.inventory_count,onChange:e=>o(s=>({...s,inventory_count:Number(e.target.value)})),placeholder:"Inventory count",className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsx("input",{value:r.digital_delivery_url,onChange:e=>o(s=>({...s,digital_delivery_url:e.target.value})),placeholder:"Private digital link (optional)",className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsxs("label",{className:"flex min-h-11 items-center gap-2 text-xs text-white/80",children:[t.jsx("input",{type:"checkbox",checked:r.is_default,onChange:e=>o(s=>({...s,is_default:e.target.checked}))}),"Default variant"]}),t.jsx("button",{type:"button",onClick:F,disabled:h,className:"min-h-11 rounded-full border border-gold/45 px-5 py-2 text-[11px] uppercase tracking-[0.22em] text-gold",children:"Save Variant"})]})]})]}),t.jsxs("div",{className:"mt-5 grid gap-4 lg:grid-cols-2",children:[t.jsxs("article",{className:"rounded-3xl border border-white/15 bg-black/35 p-5",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.24em] text-white/55",children:"Catalog"}),t.jsx("div",{className:"mt-3 space-y-2",children:l.products.map(e=>t.jsxs("button",{type:"button",onClick:()=>E(e.id),className:`w-full rounded-xl border px-3 py-2 text-left text-sm ${b===e.id?"border-gold/60 bg-gold/10":"border-white/15 bg-black/25"}`,children:[t.jsx("p",{children:e.name}),t.jsxs("p",{className:"text-xs text-white/55",children:[e.status," | ",e.product_type," | ",j(e.base_price_cents,e.currency)]})]},e.id))}),!!b&&t.jsxs("div",{className:"mt-3 rounded-xl border border-white/10 bg-black/20 p-3",children:[t.jsxs("p",{className:"text-[10px] uppercase tracking-[0.2em] text-gold/80",children:["Variants for ",k.get(b)?.name]}),t.jsxs("ul",{className:"mt-2 space-y-2",children:[v.map(e=>t.jsxs("li",{className:"rounded-lg border border-white/10 p-2 text-xs text-white/75",children:[e.title," (",e.sku,") | ",j(e.price_cents)," | ",e.inventory_mode,e.inventory_mode==="finite"?`:${e.inventory_count??0}`:""]},e.id)),!v.length&&t.jsx("li",{className:"text-xs text-white/50",children:"No variants for this product."})]})]})]}),t.jsxs("article",{className:"rounded-3xl border border-white/15 bg-black/35 p-5",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.24em] text-white/55",children:"Reviews Moderation"}),t.jsxs("div",{className:"mt-3 space-y-2",children:[l.reviews.slice(0,30).map(e=>t.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/20 p-3",children:[t.jsxs("p",{className:"text-xs text-gold",children:[e.rating," / 5"]}),t.jsx("p",{className:"text-sm text-white/90",children:e.title}),t.jsx("p",{className:"mt-1 text-xs text-white/65",children:e.body}),t.jsxs("div",{className:"mt-2 flex gap-2",children:[t.jsx("button",{type:"button",onClick:async()=>{const s=await C(e.id,"approved");n(s.ok?"Review approved.":s.error),s.ok&&await u()},className:"min-h-10 rounded-full border border-gold/45 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-gold",children:"Approve"}),t.jsx("button",{type:"button",onClick:async()=>{const s=await C(e.id,"rejected");n(s.ok?"Review rejected.":s.error),s.ok&&await u()},className:"min-h-10 rounded-full border border-white/35 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-white/75",children:"Reject"}),t.jsx("span",{className:"text-[11px] text-white/55",children:e.status})]})]},e.id)),!l.reviews.length&&t.jsx("p",{className:"text-sm text-white/60",children:"No reviews yet."})]})]})]}),t.jsxs("article",{className:"mt-5 rounded-3xl border border-white/15 bg-black/35 p-5",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.24em] text-white/55",children:"Orders"}),t.jsxs("div",{className:"mt-3 space-y-3",children:[l.orders.map(e=>t.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/20 p-3",children:[t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[t.jsxs("p",{className:"text-sm text-white/90",children:["Order #",e.id," | ",e.status]}),t.jsx("p",{className:"text-sm text-gold",children:j(e.total_cents,e.currency)})]}),t.jsxs("p",{className:"text-xs text-white/55",children:[e.stripe_customer_email||"No email"," | ",new Date(e.created_at).toLocaleString()]}),t.jsx("ul",{className:"mt-2 space-y-1 text-xs text-white/70",children:(V.get(e.id)||[]).map(s=>t.jsxs("li",{children:[s.title," ",s.variant_title?`(${s.variant_title})`:""," x",s.quantity]},s.id))}),t.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",onClick:()=>g(e.id,"refund"),className:"min-h-10 rounded-full border border-gold/45 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-gold",children:"Refund"}),t.jsx("button",{type:"button",onClick:()=>g(e.id,"cancel"),className:"min-h-10 rounded-full border border-white/35 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-white/75",children:"Cancel"}),t.jsx("button",{type:"button",onClick:()=>g(e.id,"mark_shipped"),className:"min-h-10 rounded-full border border-white/35 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-white/75",children:"Mark shipped"}),t.jsx("button",{type:"button",onClick:()=>g(e.id,"resend_download_link"),className:"min-h-10 rounded-full border border-white/35 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-white/75",children:"Resend link"})]})]},e.id)),!l.orders.length&&t.jsx("p",{className:"text-sm text-white/60",children:"No orders synced yet. Configure webhook and run a checkout."})]})]}),d&&t.jsx("p",{className:"mt-4 text-sm text-gold",children:d})]}):t.jsx("section",{className:"mx-auto w-full max-w-3xl px-4 pb-20 pt-8 sm:px-6",children:t.jsxs("div",{className:"rounded-3xl border border-white/15 bg-black/45 p-6",children:[t.jsxs("p",{className:"text-sm text-white/75",children:["Signed in as ",w,", but this account is not in `store_admins`."]}),t.jsx("button",{type:"button",onClick:async()=>{await _(),window.location.reload()},className:"mt-4 min-h-11 rounded-full border border-white/30 px-5 py-2 text-xs uppercase tracking-[0.24em] text-white/80",children:"Sign out"}),d&&t.jsx("p",{className:"mt-3 text-sm text-gold",children:d})]})}):t.jsx("section",{className:"mx-auto w-full max-w-3xl px-4 pb-20 pt-8 sm:px-6",children:t.jsxs("div",{className:"rounded-3xl border border-white/15 bg-black/45 p-6",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gold/80",children:"Store Admin"}),t.jsx("h1",{className:"mt-2 font-display text-3xl",children:"Sign In"}),t.jsx("p",{className:"mt-2 text-sm text-white/70",children:"Use a magic link or federated login. Access is restricted to users in `store_admins`."}),t.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[t.jsx("input",{value:N,onChange:e=>A(e.target.value),placeholder:"admin@theperforma.com",className:"min-h-11 flex-1 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsx("button",{type:"button",onClick:U,disabled:h,className:"min-h-11 rounded-full bg-ember px-5 py-2 text-[11px] uppercase tracking-[0.22em] text-ink",children:h?"Sending...":"Magic Link"})]}),t.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:["google","github","facebook","apple"].map(e=>t.jsx("button",{type:"button",onClick:()=>$(e),className:"min-h-11 rounded-full border border-white/30 px-4 py-2 text-[11px] uppercase tracking-[0.22em] text-white/80",children:e},e))}),d&&t.jsx("p",{className:"mt-3 text-sm text-gold",children:d})]})})}export{se as default};
