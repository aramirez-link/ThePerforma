import{j as t}from"./jsx-runtime.TBa3i5EZ.js";import{r}from"./index.CVf8TyFT.js";const E="the-performa-engagement-v1",_="the-performa-badges-v1",j=()=>new Date().toISOString().slice(0,10),T=(i=new Date)=>{const n=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate())),a=n.getUTCDay()||7;n.setUTCDate(n.getUTCDate()+4-a);const g=new Date(Date.UTC(n.getUTCFullYear(),0,1)),l=Math.ceil(((n.getTime()-g.getTime())/864e5+1)/7);return`${n.getUTCFullYear()}-W${String(l).padStart(2,"0")}`},p=()=>({points:120,streak:1,lastSeenDate:j(),dailyClaimDate:"",weekKey:T(),weeklySignal:0,visitedPaths:[],reactions:{fire:0,bolt:0,hands:0},missions:{stageMode:!1,watchAndListen:!1,innerCircle:!1}}),C=i=>new Date(`${i}T00:00:00`),H=(i,n)=>{const a=C(n).getTime()-C(i).getTime();return Math.round(a/864e5)},J=()=>{if(typeof window>"u")return p();try{const i=localStorage.getItem(E);if(!i)return p();const n=JSON.parse(i);return{...p(),...n,reactions:{...p().reactions,...n.reactions??{}},missions:{...p().missions,...n.missions??{}}}}catch{return p()}},V=i=>{localStorage.setItem(E,JSON.stringify(i))},b=80,D=[{key:"stageMode",label:"Activate Stage Mode once",reward:b},{key:"watchAndListen",label:"Visit Watch + Listen",reward:b},{key:"innerCircle",label:"Open Inner Circle Access",reward:b}],G=[{name:"Signal Runner",base:980},{name:"Night Architect",base:860},{name:"Vault Operator",base:740}],z=[{id:"first-signal",label:"First Signal",tier:"core",tip:"Earned by crossing 160 points.",rule:(i,n)=>i.points>=160},{id:"return-runner",label:"Return Runner",tier:"elite",tip:"Earned by maintaining a 3-day streak.",rule:(i,n)=>i.streak>=3},{id:"mission-control",label:"Mission Control",tier:"legend",tip:"Earned by completing all missions.",rule:(i,n)=>n>=3},{id:"crowd-igniter",label:"Crowd Igniter",tier:"elite",tip:"Earned by maxing this week's challenge.",rule:(i,n)=>i.weeklySignal>=220}];function X(){const[i,n]=r.useState(!1),[a,g]=r.useState(()=>J()),[l,c]=r.useState(""),[M,A]=r.useState("ember"),[d,O]=r.useState({fire:0,bolt:0,hands:0}),w=r.useMemo(()=>Object.values(a.missions).filter(Boolean).length,[a.missions]),P=D.length,R=Math.ceil((a.points+1)/200)*200,f=220,N=Math.min(f,a.weeklySignal),L=Math.round(N/f*100),h=r.useMemo(()=>z.filter(e=>e.rule(a,w)),[a,w]),W=e=>e==="legend"?"badge-tier-legend border-amber-300/60 text-amber-200 bg-amber-500/10":e==="elite"?"badge-tier-elite border-cyan-300/55 text-cyan-200 bg-cyan-500/10":"badge-tier-core border-gold/40 text-gold bg-black/40",U=r.useMemo(()=>[...G.map(e=>({...e,score:e.base+(a.points*3+a.streak*11)%140})),{name:"You",score:a.points+a.streak*17+420}].sort((e,s)=>s.score-e.score),[a.points,a.streak]),m=e=>{g(s=>{const o=e(s);return V(o),o})},y=e=>{m(s=>s.missions[e]?s:{...s,points:s.points+b,missions:{...s.missions,[e]:!0}})},v=e=>{m(s=>{const o=j(),S=H(s.lastSeenDate,o),I=S===1?s.streak+1:S>1?1:s.streak,u=s.visitedPaths.includes(e)?s.visitedPaths:[...s.visitedPaths,e],B=u.some(x=>x.startsWith("/watch")),F=u.some(x=>x.startsWith("/listen")),K=u.some(x=>x.startsWith("/fan-club"));return{...s,streak:I,lastSeenDate:o,visitedPaths:u,missions:{...s.missions,watchAndListen:s.missions.watchAndListen||B&&F,innerCircle:s.missions.innerCircle||K}}})};r.useEffect(()=>{v(window.location.pathname);const e=()=>v(window.location.pathname);document.addEventListener("astro:after-swap",e);const s=()=>{document.body.dataset.stage==="true"&&y("stageMode")},o=window.__stageMode?.subscribe?.(s);return s(),()=>{document.removeEventListener("astro:after-swap",e),o&&o()}},[]),r.useEffect(()=>{const e=T();a.weekKey!==e&&m(s=>({...s,weekKey:e,weeklySignal:0}))},[a.weekKey]),r.useEffect(()=>{a.missions.watchAndListen&&y("watchAndListen")},[a.missions.watchAndListen]),r.useEffect(()=>{a.missions.innerCircle&&y("innerCircle")},[a.missions.innerCircle]),r.useEffect(()=>{if(!l)return;const e=window.setTimeout(()=>c(""),1600);return()=>window.clearTimeout(e)},[l]),r.useEffect(()=>{const e=JSON.stringify(h);localStorage.setItem(_,e),window.dispatchEvent(new CustomEvent("performa:badges-updated",{detail:h}))},[h]),r.useEffect(()=>{const e=()=>A(document.body.dataset.stageTheme||"ember");e();const s=new MutationObserver(e);return s.observe(document.body,{attributes:!0,attributeFilter:["data-stage-theme"]}),()=>s.disconnect()},[]);const k=e=>{m(s=>({...s,points:s.points+5,weeklySignal:s.weeklySignal+10,reactions:{...s.reactions,[e]:s.reactions[e]+1}})),O(s=>({...s,[e]:s[e]+1})),c("Reaction sent +5")},Y=()=>{const e=j();if(a.dailyClaimDate===e){c("Daily already claimed");return}m(s=>({...s,points:s.points+40,weeklySignal:s.weeklySignal+20,dailyClaimDate:e})),c("Daily check-in +40")},$=async()=>{const e={title:"Chip Lee - The Performa",text:"Stage Mode is live. Tap in.",url:window.location.href};try{navigator.share?await navigator.share(e):await navigator.clipboard.writeText(window.location.href),m(s=>({...s,points:s.points+15,weeklySignal:s.weeklySignal+15})),c("Share pulse +15")}catch{c("Share cancelled")}};return t.jsxs("aside",{className:"fixed left-4 bottom-4 z-[72] w-[min(92vw,360px)] rounded-2xl border bg-black/75 p-3 shadow-[0_12px_42px_rgba(0,0,0,0.58)] backdrop-blur-xl",style:{borderColor:"rgba(var(--accent-rgb), 0.45)",boxShadow:"0 12px 42px rgba(0,0,0,0.58), 0 0 36px rgba(var(--accent-rgb), 0.2)"},"data-theme":M,"aria-label":"Fan engagement hub",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-[10px] uppercase tracking-[0.3em] text-gold/90",children:"Crowd Pulse - Rate Me"}),t.jsxs("p",{className:"mt-1 text-xs text-white/70",children:["Points ",a.points," | Streak ",a.streak,"d"]})]}),t.jsx("button",{type:"button",onClick:()=>n(e=>!e),className:"rounded-full border border-white/25 px-3 py-1 text-[10px] uppercase tracking-[0.26em] text-white/80 hover:border-gold/60 hover:text-gold","aria-expanded":i,children:i?"Hide":"Open"})]}),i&&t.jsxs("div",{className:"mt-3 space-y-3",children:[t.jsxs("div",{className:"rounded-xl border border-white/15 bg-black/70 p-3",children:[t.jsx("p",{className:"text-[10px] uppercase tracking-[0.26em] text-white/55",children:"Crowd Pulse"}),t.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[t.jsxs("button",{type:"button",onClick:()=>k("fire"),className:"reaction-btn rounded-full border border-white/20 px-3 py-1 text-sm hover:border-gold/60",children:["FIRE ",120+a.reactions.fire,d.fire>0&&t.jsx("span",{className:"reaction-burst reaction-burst-fire","aria-hidden":"true"},d.fire)]}),t.jsxs("button",{type:"button",onClick:()=>k("bolt"),className:"reaction-btn rounded-full border border-white/20 px-3 py-1 text-sm hover:border-gold/60",children:["HYPE ",84+a.reactions.bolt,d.bolt>0&&t.jsx("span",{className:"reaction-burst reaction-burst-hype","aria-hidden":"true"},d.bolt)]}),t.jsxs("button",{type:"button",onClick:()=>k("hands"),className:"reaction-btn rounded-full border border-white/20 px-3 py-1 text-sm hover:border-gold/60",children:["CHEER ",57+a.reactions.hands,d.hands>0&&t.jsx("span",{className:"reaction-burst reaction-burst-cheer","aria-hidden":"true"},d.hands)]})]})]}),t.jsxs("div",{className:"rounded-xl border border-white/15 bg-black/70 p-3",children:[t.jsx("p",{className:"text-[10px] uppercase tracking-[0.26em] text-white/55",children:"Daily Ops"}),t.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",onClick:Y,className:"rounded-full border border-gold/30 px-4 py-2 text-[10px] uppercase tracking-[0.22em] text-gold hover:bg-gold/10",children:"Daily Check-in"}),t.jsx("button",{type:"button",onClick:$,className:"rounded-full border border-white/25 px-4 py-2 text-[10px] uppercase tracking-[0.22em] text-white/80 hover:border-white/50 hover:text-white",children:"Share Signal"})]}),t.jsxs("p",{className:"mt-2 text-[11px] text-white/55",children:["Next milestone unlock at ",R," points."]})]}),t.jsxs("div",{className:"rounded-xl border border-white/15 bg-black/70 p-3",children:[t.jsx("p",{className:"text-[10px] uppercase tracking-[0.26em] text-white/55",children:"Return Missions"}),t.jsx("ul",{className:"mt-2 space-y-2 text-xs text-white/75",children:D.map(e=>t.jsxs("li",{className:"flex items-center justify-between gap-3",children:[t.jsx("span",{children:e.label}),t.jsx("span",{className:a.missions[e.key]?"text-gold":"text-white/45",children:a.missions[e.key]?"Complete":`+${e.reward}`})]},e.key))}),t.jsxs("p",{className:"mt-2 text-[11px] text-white/55",children:[w,"/",P," missions completed"]})]}),t.jsxs("div",{className:"rounded-xl border border-white/15 bg-black/70 p-3",children:[t.jsx("p",{className:"text-[10px] uppercase tracking-[0.26em] text-white/55",children:"Weekly Challenge"}),t.jsx("p",{className:"mt-2 text-xs text-white/75",children:"Push the crowd meter to 100% this week."}),t.jsx("div",{className:"mt-2 h-2 overflow-hidden rounded-full bg-white/10",children:t.jsx("div",{className:"h-full rounded-full transition-[width] duration-500",style:{width:`${L}%`,background:"linear-gradient(90deg, rgba(var(--accent-rgb),0.55), rgba(var(--accent-rgb),1))"}})}),t.jsxs("p",{className:"mt-2 text-[11px] text-white/55",children:[N,"/",f," signal points"]}),t.jsx("p",{className:"mt-1 text-[11px] text-white/45",children:"Weekly reset: Monday 12:00 AM local"})]}),t.jsxs("div",{className:"rounded-xl border border-white/15 bg-black/70 p-3",children:[t.jsx("p",{className:"text-[10px] uppercase tracking-[0.26em] text-white/55",children:"Community Heat"}),t.jsx("ul",{className:"mt-2 space-y-2 text-xs text-white/75",children:U.map((e,s)=>t.jsxs("li",{className:"flex items-center justify-between gap-3",children:[t.jsxs("span",{children:["#",s+1," ",e.name]}),t.jsx("span",{className:e.name==="You"?"text-gold":"text-white/60",children:e.score})]},e.name))})]}),t.jsxs("div",{className:"rounded-xl border border-white/15 bg-black/70 p-3",children:[t.jsx("p",{className:"text-[10px] uppercase tracking-[0.26em] text-white/55",children:"Unlocked Badges"}),t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:h.length>0?h.map(e=>t.jsxs("span",{title:`${e.label} (${e.tier.toUpperCase()}): ${e.tip}`,className:`rounded-full border px-3 py-1 text-[10px] uppercase tracking-[0.2em] ${W(e.tier)}`,children:[e.label," Â· ",e.tier]},e.id)):t.jsx("span",{className:"text-xs text-white/50",children:"No badges unlocked yet."})})]})]}),l&&t.jsx("p",{className:"mt-3 text-xs text-gold",children:l})]})}export{X as default};
