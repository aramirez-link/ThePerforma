import{j as t}from"./jsx-runtime.TBa3i5EZ.js";import{r as a}from"./index.CVf8TyFT.js";import{c as ve,a as we,r as q,u as je,b as ee,l as fe,d as Ne}from"./fanVault.BDzHPXqn.js";import{g as te,s as ye,a as ke,i as Ce}from"./storefront.DD1YA6uZ.js";import"./index.BtUICepX.js";const b="the-performa-admin-nav",ae=x=>{if(!x)return"";const o=new Date(x);if(Number.isNaN(o.getTime()))return"";const l=i=>String(i).padStart(2,"0");return`${o.getFullYear()}-${l(o.getMonth()+1)}-${l(o.getDate())}T${l(o.getHours())}:${l(o.getMinutes())}`};function Ee(){const[x,o]=a.useState(!0),[l,i]=a.useState(!1),[d,r]=a.useState(""),[v,se]=a.useState(""),[h,re]=a.useState(""),[ie,ne]=a.useState(!1),[m,le]=a.useState([]),[oe,ce]=a.useState([]),[w,j]=a.useState(""),[g,f]=a.useState(["","","",""]),[N,y]=a.useState(0),[k,C]=a.useState("general"),[S,A]=a.useState("medium"),[T,Q]=a.useState(""),[I,E]=a.useState(""),[M,D]=a.useState(""),[L,$]=a.useState(""),[O,R]=a.useState(""),[P,U]=a.useState(60),[B,_]=a.useState(10),[V,F]=a.useState("draft"),[H,W]=a.useState([]),[Y,G]=a.useState("Trivia Beacon"),[K,z]=a.useState("#f9b233"),[J,X]=a.useState("gold"),c=async()=>{const[e,s]=await Promise.all([fe(),Ne()]);if(!e.ok){r(e.error);return}if(!s.ok){r(s.error);return}le(e.questions),ce(s.campaigns)};a.useEffect(()=>{const e=async()=>{o(!0);const u=await ke();re(u?.email||"");const p=await Ce();ne(p),typeof window<"u"&&(p?localStorage.setItem(b,"true"):localStorage.removeItem(b)),p&&await c(),o(!1)};e();const n=te()?.auth.onAuthStateChange(()=>{e()});return()=>n?.data.subscription.unsubscribe()},[]),a.useEffect(()=>{if(!d)return;const e=window.setTimeout(()=>r(""),3200);return()=>window.clearTimeout(e)},[d]);const de=a.useMemo(()=>m.filter(e=>e.isActive).length,[m]),ue=async()=>{const e=te();if(!e){r("Supabase is not configured.");return}i(!0);const{error:s}=await e.auth.signInWithOtp({email:v.trim().toLowerCase(),options:{emailRedirectTo:typeof window<"u"?`${window.location.origin}/admin/trivia`:void 0}});i(!1),r(s?s.message:"Check your email for the magic link.")},pe=async()=>{i(!0);const e=await ve({prompt:w,options:g,correctOptionIndex:N,category:k,difficulty:S,imageUrl:T||null,explanation:I||null});if(i(!1),!e.ok){r(e.error);return}j(""),f(["","","",""]),y(0),C("general"),A("medium"),Q(""),E(""),r("Trivia question added."),await c()},xe=async()=>{i(!0);const e=await we({title:M,questionIds:H,startAt:L,endAt:O||null,cadenceMinutes:P,postDurationMinutes:B,status:V,lookAndFeel:{label:Y,accentColor:K,cardTone:J}});if(i(!1),!e.ok){r(e.error);return}D(""),$(""),R(""),U(60),_(10),F("draft"),W([]),G("Trivia Beacon"),z("#f9b233"),X("gold"),r("Trivia campaign created."),await c()},me=async()=>{i(!0);const e=await q(20);if(i(!1),!e.ok){r(e.error);return}r(`Scheduler published ${e.posted} trivia post${e.posted===1?"":"s"}.`),await c()},he=async e=>{i(!0);const s=await je({id:e.id,prompt:e.prompt,options:e.options,correctOptionIndex:e.correctOptionIndex,category:e.category,difficulty:e.difficulty,imageUrl:e.imageUrl,explanation:e.explanation,isActive:!e.isActive});if(i(!1),!s.ok){r(s.error);return}r(e.isActive?"Question disabled.":"Question enabled."),await c()},Z=async(e,s)=>{i(!0);const n=await ee({id:e,status:s});if(i(!1),!n.ok){r(n.error);return}r(`Campaign ${s}.`),await c()},ge=async e=>{i(!0);const s=await ee({id:e,status:"active",nextRunAt:new Date().toISOString()});if(!s.ok){i(!1),r(s.error);return}const n=await q(20);if(i(!1),!n.ok){r(n.error);return}r(`Campaign triggered. Published ${n.posted} post${n.posted===1?"":"s"}.`),await c()};return x?t.jsx("section",{className:"mx-auto w-full max-w-6xl px-4 pb-20 pt-8 sm:px-6",children:t.jsx("div",{className:"rounded-3xl border border-white/15 bg-black/45 p-6",children:t.jsx("p",{className:"text-sm text-white/70",children:"Loading trivia console..."})})}):h?ie?t.jsxs("section",{className:"mx-auto w-full max-w-7xl space-y-5 px-4 pb-20 pt-8 sm:px-6",children:[t.jsxs("div",{className:"rounded-3xl border border-white/15 bg-black/45 p-6",children:[t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gold/80",children:"Admin Trivia"}),t.jsx("h1",{className:"mt-2 font-display text-3xl",children:"Trivia Campaign Control"}),t.jsx("p",{className:"mt-1 text-sm text-white/70",children:h})]}),t.jsx("button",{type:"button",onClick:me,disabled:l,className:"min-h-11 rounded-full border border-gold/45 px-4 py-2 text-[11px] uppercase tracking-[0.22em] text-gold disabled:opacity-50",children:l?"Working...":"Run Scheduler Now"})]}),t.jsxs("p",{className:"mt-2 text-xs text-white/55",children:["Shared question bank: ",de," active question(s)."]}),d&&t.jsx("p",{className:"mt-3 text-sm text-gold",children:d})]}),t.jsxs("div",{className:"grid gap-5 lg:grid-cols-2",children:[t.jsxs("article",{className:"rounded-3xl border border-white/15 bg-black/45 p-6",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-gold/80",children:"Question Bank"}),t.jsx("h2",{className:"mt-2 font-display text-2xl",children:"Create Trivia Question"}),t.jsxs("div",{className:"mt-4 grid gap-3",children:[t.jsx("textarea",{value:w,onChange:e=>j(e.target.value),rows:3,placeholder:"Trivia prompt",className:"rounded-2xl border border-white/20 bg-black/35 px-4 py-3 text-sm"}),g.map((e,s)=>t.jsx("input",{value:e,onChange:n=>f(u=>u.map((p,be)=>be===s?n.target.value:p)),placeholder:`Option ${s+1}`,className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"},`q-opt-${s}`)),t.jsxs("div",{className:"grid gap-2 sm:grid-cols-3",children:[t.jsx("select",{value:String(N),onChange:e=>y(Number(e.target.value)),className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm",children:g.map((e,s)=>t.jsxs("option",{value:s,children:["Correct: Option ",s+1]},`correct-${s}`))}),t.jsx("input",{value:k,onChange:e=>C(e.target.value),placeholder:"Category",className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsxs("select",{value:S,onChange:e=>A(e.target.value),className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm",children:[t.jsx("option",{value:"easy",children:"Easy"}),t.jsx("option",{value:"medium",children:"Medium"}),t.jsx("option",{value:"hard",children:"Hard"})]})]}),t.jsx("input",{value:T,onChange:e=>Q(e.target.value),placeholder:"Optional image URL",className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsx("textarea",{value:I,onChange:e=>E(e.target.value),rows:2,placeholder:"Optional explanation",className:"rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsx("button",{type:"button",onClick:pe,disabled:l,className:"min-h-11 rounded-full bg-ember px-5 py-2 text-[11px] uppercase tracking-[0.22em] text-ink disabled:opacity-50",children:"Add Question"})]})]}),t.jsxs("article",{className:"rounded-3xl border border-white/15 bg-black/45 p-6",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-gold/80",children:"Campaign Builder"}),t.jsx("h2",{className:"mt-2 font-display text-2xl",children:"Schedule Trivia Campaign"}),t.jsxs("div",{className:"mt-4 grid gap-3",children:[t.jsx("input",{value:M,onChange:e=>D(e.target.value),placeholder:"Campaign title",className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[t.jsxs("label",{className:"grid gap-1 text-xs text-white/65",children:["Start",t.jsx("input",{type:"datetime-local",value:L,onChange:e=>$(e.target.value),className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"})]}),t.jsxs("label",{className:"grid gap-1 text-xs text-white/65",children:["End (optional)",t.jsx("input",{type:"datetime-local",value:O,onChange:e=>R(e.target.value),className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"})]})]}),t.jsxs("div",{className:"grid gap-2 sm:grid-cols-3",children:[t.jsxs("label",{className:"grid gap-1 text-xs text-white/65",children:["Cadence (min)",t.jsx("input",{type:"number",min:1,max:1440,value:P,onChange:e=>U(Number(e.target.value)||60),className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"})]}),t.jsxs("label",{className:"grid gap-1 text-xs text-white/65",children:["Post timer (min)",t.jsx("input",{type:"number",min:1,max:60,value:B,onChange:e=>_(Number(e.target.value)||10),className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"})]}),t.jsxs("label",{className:"grid gap-1 text-xs text-white/65",children:["Status",t.jsxs("select",{value:V,onChange:e=>F(e.target.value),className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm",children:[t.jsx("option",{value:"draft",children:"Draft"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"paused",children:"Paused"}),t.jsx("option",{value:"completed",children:"Completed"})]})]})]}),t.jsxs("div",{className:"rounded-2xl border border-white/20 bg-black/30 p-3",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-white/55",children:"Question selection"}),t.jsx("div",{className:"mt-2 max-h-36 space-y-2 overflow-auto",children:m.map(e=>t.jsxs("label",{className:"flex items-start gap-2 text-xs text-white/80",children:[t.jsx("input",{type:"checkbox",checked:H.includes(e.id),onChange:s=>W(n=>s.target.checked?[...n,e.id]:n.filter(u=>u!==e.id)),className:"mt-1 h-4 w-4"}),t.jsx("span",{children:e.prompt})]},e.id))})]}),t.jsxs("div",{className:"grid gap-2 sm:grid-cols-3",children:[t.jsx("input",{value:Y,onChange:e=>G(e.target.value),placeholder:"Label",className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsx("input",{value:K,onChange:e=>z(e.target.value),placeholder:"#f9b233",className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsxs("select",{value:J,onChange:e=>X(e.target.value),className:"min-h-11 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm",children:[t.jsx("option",{value:"gold",children:"Gold"}),t.jsx("option",{value:"ember",children:"Ember"}),t.jsx("option",{value:"cyan",children:"Cyan"}),t.jsx("option",{value:"neutral",children:"Neutral"})]})]}),t.jsx("button",{type:"button",onClick:xe,disabled:l,className:"min-h-11 rounded-full bg-ember px-5 py-2 text-[11px] uppercase tracking-[0.22em] text-ink disabled:opacity-50",children:"Create Campaign"})]})]})]}),t.jsxs("article",{className:"rounded-3xl border border-white/15 bg-black/45 p-6",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-gold/80",children:"Question Bank"}),t.jsx("div",{className:"mt-3 grid gap-2",children:m.map(e=>t.jsxs("div",{className:"rounded-2xl border border-white/15 bg-black/30 px-4 py-3",children:[t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[t.jsx("p",{className:"text-sm text-white/90",children:e.prompt}),t.jsx("button",{type:"button",onClick:()=>he(e),className:"min-h-10 rounded-full border border-white/25 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-white/75",children:e.isActive?"Disable":"Enable"})]}),t.jsxs("p",{className:"mt-1 text-xs text-white/55",children:[e.category," · ",e.difficulty," · ",e.options.length," options"]})]},e.id))})]}),t.jsxs("article",{className:"rounded-3xl border border-white/15 bg-black/45 p-6",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-gold/80",children:"Campaigns"}),t.jsx("div",{className:"mt-3 grid gap-2",children:oe.map(e=>t.jsxs("div",{className:"rounded-2xl border border-white/15 bg-black/30 px-4 py-3",children:[t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[t.jsx("p",{className:"text-sm text-white/90",children:e.title}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("button",{type:"button",onClick:()=>ge(e.id),className:"min-h-10 rounded-full border border-gold/35 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-gold",children:"Run Now"}),e.status!=="active"&&t.jsx("button",{type:"button",onClick:()=>Z(e.id,"active"),className:"min-h-10 rounded-full border border-white/25 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-white/75",children:"Activate"}),e.status==="active"&&t.jsx("button",{type:"button",onClick:()=>Z(e.id,"paused"),className:"min-h-10 rounded-full border border-white/25 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-white/75",children:"Pause"})]})]}),t.jsxs("p",{className:"mt-1 text-xs text-white/55",children:["Status: ",e.status," · Questions: ",e.questionIds.length," · Every ",e.cadenceMinutes,"m · Duration ",e.postDurationMinutes,"m"]}),t.jsxs("p",{className:"mt-1 text-xs text-white/50",children:["Next run: ",ae(e.nextRunAt).replace("T"," ")," · Last run: ",e.lastRunAt?ae(e.lastRunAt).replace("T"," "):"n/a"]})]},e.id))})]})]}):t.jsx("section",{className:"mx-auto w-full max-w-3xl px-4 pb-20 pt-8 sm:px-6",children:t.jsxs("div",{className:"rounded-3xl border border-white/15 bg-black/45 p-6",children:[t.jsxs("p",{className:"text-sm text-white/75",children:["Signed in as ",h,", but this account is not in `store_admins`."]}),t.jsx("button",{type:"button",onClick:async()=>{localStorage.removeItem(b),await ye(),window.location.reload()},className:"mt-4 min-h-11 rounded-full border border-white/30 px-5 py-2 text-xs uppercase tracking-[0.24em] text-white/80",children:"Sign out"})]})}):t.jsx("section",{className:"mx-auto w-full max-w-3xl px-4 pb-20 pt-8 sm:px-6",children:t.jsxs("div",{className:"rounded-3xl border border-white/15 bg-black/45 p-6",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gold/80",children:"Admin Trivia"}),t.jsx("h1",{className:"mt-2 font-display text-3xl",children:"Sign In"}),t.jsx("p",{className:"mt-2 text-sm text-white/70",children:"Use a magic link. Access is restricted to users in `store_admins`."}),t.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[t.jsx("input",{value:v,onChange:e=>se(e.target.value),placeholder:"admin@theperforma.com",className:"min-h-11 flex-1 rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm"}),t.jsx("button",{type:"button",onClick:ue,disabled:l,className:"min-h-11 rounded-full bg-ember px-5 py-2 text-[11px] uppercase tracking-[0.22em] text-ink",children:l?"Sending...":"Magic Link"})]}),d&&t.jsx("p",{className:"mt-3 text-sm text-gold",children:d})]})})}export{Ee as default};
