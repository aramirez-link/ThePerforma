import{j as t}from"./jsx-runtime.TBa3i5EZ.js";import{r as n}from"./index.CVf8TyFT.js";import{a as q,f as N,L as H,j as K,k as Q,b as Y,m as z,n as G,o as X,p as Z}from"./storefront.CQ1BUduJ.js";import"./index.BtUICepX.js";const E="the-performa-store-cart-v1",ee=()=>{if(typeof window>"u")return[];try{const l=localStorage.getItem(E);if(!l)return[];const p=JSON.parse(l);return Array.isArray(p)?p.filter(x=>x&&typeof x.variantId=="string").map(x=>({variantId:x.variantId,quantity:Math.max(1,Number(x.quantity||1))})):[]}catch{return[]}},j=l=>{typeof window>"u"||localStorage.setItem(E,JSON.stringify(l))},te=l=>{if(!l.length)return 0;const p=l.reduce((x,b)=>x+b,0);return Math.round(p/l.length*10)/10};function ne(){const[l,p]=n.useState([]),[x,b]=n.useState([]),[k,S]=n.useState({}),[h,f]=n.useState([]),[w,L]=n.useState("all"),[C,P]=n.useState(""),[_,I]=n.useState(!0),[O,M]=n.useState(!1),[v,o]=n.useState(""),[R,D]=n.useState(""),[d,y]=n.useState({productId:"",rating:5,title:"",body:""});n.useEffect(()=>{(async()=>{I(!0);const[a,r]=await Promise.all([K(),Q()]),i=await Y();if(D(i?.email||""),a.ok){p(a.data);const c={};for(const m of a.data)m.defaultVariant&&(c[m.id]=m.defaultVariant.id);S(c)}else o(a.error);r.ok&&b(r.data),f(ee()),I(!1)})()},[]),n.useEffect(()=>{if(!v)return;const e=window.setTimeout(()=>o(""),2400);return()=>window.clearTimeout(e)},[v]);const V=n.useMemo(()=>w==="all"?l:l.filter(e=>e.product_type===w),[w,l]),T=n.useMemo(()=>{const e=new Map;for(const a of l)for(const r of a.variants)e.set(r.id,{product:a,variant:r});return e},[l]),g=n.useMemo(()=>h.map(e=>{const a=T.get(e.variantId);return a?{...e,...a,lineTotal:a.variant.price_cents*e.quantity}:null}).filter(Boolean),[h,T]),$=g.reduce((e,a)=>e+a.lineTotal,0),A=async e=>{const a=x.includes(e),r=a?await z(e):await G(e);if(!r.ok){o(r.error);return}b(i=>a?i.filter(c=>c!==e):[e,...i]),o(a?"Removed from wishlist.":"Saved to wishlist.")},U=(e,a)=>{S(r=>({...r,[e]:a}))},F=e=>{const a=k[e.id]||e.defaultVariant?.id;if(!a){o("No variant available for this product.");return}const r=e.variants.find(s=>s.id===a)||null;if(!r){o("Selected variant is unavailable.");return}const i=q(r);if(i.outOfStock){o("This variant is currently out of stock.");return}const c=[...h],m=c.find(s=>s.variantId===a);if(m){const s=m.quantity+1;if(i.remaining!=null&&s>i.remaining){o(`Only ${i.remaining} left in stock.`);return}m.quantity=s}else c.unshift({variantId:a,quantity:1});f(c),j(c),o("Added to cart.")},W=(e,a)=>{if(a<=0){const i=h.filter(c=>c.variantId!==e);f(i),j(i);return}const r=h.map(i=>i.variantId===e?{...i,quantity:a}:i);f(r),j(r)},B=async()=>{if(!g.length){o("Your cart is empty.");return}if(!R){o("Log in to Fan Vault before checkout.");return}M(!0);const e=window.location.origin,a=await X({items:g.map(r=>({variantId:r.variant.id,quantity:r.quantity})),promoCode:C.trim()||void 0,successUrl:`${e}/store?checkout=success`,cancelUrl:`${e}/store?checkout=cancelled`});if(M(!1),!a.ok){o(a.error);return}window.location.assign(a.data.checkoutUrl)},J=async e=>{if(!d.body.trim()||!d.title.trim()){o("Write a title and review body.");return}const a=await Z({productId:e,rating:d.rating,title:d.title,body:d.body});if(!a.ok){o(a.error);return}y({productId:"",rating:5,title:"",body:""}),o("Review submitted for moderation.")};return t.jsxs("section",{className:"mx-auto w-full max-w-6xl px-4 pb-20 pt-8 sm:px-6",children:[t.jsxs("div",{className:"rounded-[2rem] border border-white/15 bg-black/45 p-6 backdrop-blur-xl",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.32em] text-gold/80",children:"Performa Store"}),t.jsx("h1",{className:"mt-2 font-display text-4xl",children:"Merch, DJ Tools, and Digital Drops"}),t.jsx("p",{className:"mt-3 max-w-3xl text-sm text-white/70",children:"Worldwide checkout with Stripe, promo codes, and private digital delivery links for downloads and tool packs."}),t.jsx("div",{className:"mt-5 flex flex-wrap gap-2",children:["all","physical","digital_tool","digital_download","subscription","bundle"].map(e=>t.jsx("button",{type:"button",onClick:()=>L(e),className:`rounded-full border px-4 py-2 text-[10px] uppercase tracking-[0.24em] min-h-11 ${w===e?"border-gold/70 bg-gold/10 text-gold":"border-white/20 text-white/75"}`,children:e.replace("_"," ")},e))})]}),t.jsxs("div",{className:"mt-7 grid gap-4 lg:grid-cols-[1fr_320px]",children:[t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[_&&t.jsx("p",{className:"text-sm text-white/70",children:"Loading store..."}),!_&&!V.length&&t.jsx("article",{className:"rounded-3xl border border-white/15 bg-black/35 p-6 text-sm text-white/70",children:"No products published yet."}),V.map(e=>{const a=k[e.id]||e.defaultVariant?.id||"",r=e.variants.find(s=>s.id===a)||e.defaultVariant,i=r?q(r):{outOfStock:!1,lowStock:!1,remaining:null},c=e.reviews.map(s=>s.rating),m=e.related_product_ids.map(s=>l.find(u=>u.id===s)).filter(Boolean).slice(0,2);return t.jsxs("article",{className:"rounded-3xl border border-white/15 bg-black/35 p-5 backdrop-blur",children:[e.cover_image&&t.jsx("img",{src:e.cover_image,alt:e.name,className:"h-48 w-full rounded-2xl border border-white/10 object-cover",loading:"lazy"}),t.jsx("p",{className:"mt-4 text-[10px] uppercase tracking-[0.24em] text-gold/80",children:e.product_type.replace("_"," ")}),t.jsx("h2",{className:"mt-2 text-2xl font-semibold",children:e.name}),t.jsx("p",{className:"mt-2 text-sm text-white/70",children:e.description}),t.jsxs("div",{className:"mt-4 flex items-center justify-between gap-2",children:[t.jsx("p",{className:"text-sm text-gold",children:N(r?.price_cents||e.base_price_cents,e.currency)}),t.jsx("p",{className:"text-xs text-white/55",children:c.length?`${te(c)} / 5 (${c.length})`:"No ratings yet"})]}),i.outOfStock&&t.jsx("p",{className:"mt-2 inline-flex rounded-full border border-rose-400/50 bg-rose-500/10 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-rose-200",children:"Out of stock"}),!i.outOfStock&&i.lowStock&&t.jsxs("p",{className:"mt-2 inline-flex rounded-full border border-gold/50 bg-gold/10 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-gold",children:["Low stock: ",i.remaining," left"]}),!!e.variants.length&&t.jsx("select",{value:a,onChange:s=>U(e.id,s.target.value),className:"mt-3 w-full rounded-xl border border-white/20 bg-black/40 px-3 py-2 text-sm min-h-11",children:e.variants.map(s=>t.jsxs("option",{value:s.id,children:[s.title," (",N(s.price_cents,e.currency),")"]},s.id))}),t.jsxs("div",{className:"mt-4 flex gap-2",children:[t.jsx("button",{type:"button",onClick:()=>F(e),disabled:i.outOfStock,className:"rounded-full bg-ember px-5 py-2 text-[11px] uppercase tracking-[0.24em] text-ink min-h-11 disabled:opacity-50",children:i.outOfStock?"Sold out":"Add to cart"}),t.jsx("button",{type:"button",onClick:()=>A(e.id),className:"rounded-full border border-white/30 px-5 py-2 text-[11px] uppercase tracking-[0.24em] text-white/80 min-h-11",children:x.includes(e.id)?"Wishlisted":"Wishlist"})]}),!!m.length&&t.jsxs("div",{className:"mt-4 rounded-2xl border border-white/10 bg-black/30 p-3",children:[t.jsx("p",{className:"text-[10px] uppercase tracking-[0.22em] text-white/55",children:"Related"}),t.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-xs text-white/75",children:m.map(s=>t.jsx("span",{className:"rounded-full border border-white/15 px-3 py-1",children:s.name},s.id))})]}),t.jsxs("div",{className:"mt-4 rounded-2xl border border-white/10 bg-black/30 p-3",children:[t.jsx("p",{className:"text-[10px] uppercase tracking-[0.22em] text-white/55",children:"Reviews"}),t.jsxs("div",{className:"mt-2 space-y-2",children:[e.reviews.slice(0,2).map(s=>t.jsxs("article",{className:"rounded-xl border border-white/10 p-2",children:[t.jsx("p",{className:"text-xs text-gold",children:"â˜…".repeat(Math.max(1,s.rating))}),t.jsx("p",{className:"text-xs text-white/85",children:s.title}),t.jsx("p",{className:"text-xs text-white/65",children:s.body})]},s.id)),!e.reviews.length&&t.jsx("p",{className:"text-xs text-white/55",children:"No approved reviews yet."})]}),t.jsxs("details",{className:"mt-2",children:[t.jsx("summary",{className:"cursor-pointer text-xs uppercase tracking-[0.2em] text-gold",children:"Write a review"}),t.jsxs("div",{className:"mt-2 grid gap-2",children:[t.jsx("input",{value:d.productId===e.id?d.title:"",onChange:s=>y(u=>({...u,productId:e.id,title:s.target.value})),className:"rounded-lg border border-white/20 bg-black/35 px-3 py-2 text-xs min-h-11",placeholder:"Review title"}),t.jsx("textarea",{value:d.productId===e.id?d.body:"",onChange:s=>y(u=>({...u,productId:e.id,body:s.target.value})),rows:3,className:"rounded-lg border border-white/20 bg-black/35 px-3 py-2 text-xs",placeholder:"Share your experience"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("select",{value:d.productId===e.id?d.rating:5,onChange:s=>y(u=>({...u,productId:e.id,rating:Number(s.target.value)})),className:"rounded-lg border border-white/20 bg-black/35 px-3 py-2 text-xs min-h-11",children:[5,4,3,2,1].map(s=>t.jsxs("option",{value:s,children:[s," stars"]},s))}),t.jsx("button",{type:"button",onClick:()=>J(e.id),className:"rounded-full border border-gold/45 px-4 py-2 text-[10px] uppercase tracking-[0.22em] text-gold min-h-11",children:"Submit"})]})]})]})]})]},e.id)})]}),t.jsxs("aside",{className:"h-fit rounded-3xl border border-white/15 bg-black/45 p-5 backdrop-blur",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-gold/80",children:"Cart"}),!R&&t.jsxs("p",{className:"mt-2 text-[11px] text-white/65",children:["Checkout requires Fan Vault login. ",t.jsx("a",{href:"/fan-club",className:"text-gold underline",children:"Log in here"}),"."]}),t.jsxs("div",{className:"mt-3 space-y-3",children:[g.map(e=>t.jsxs("article",{className:"rounded-xl border border-white/10 p-3",children:[t.jsx("p",{className:"text-xs text-white/90",children:e.product.name}),t.jsx("p",{className:"text-[11px] text-white/60",children:e.variant.title}),t.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[t.jsx("input",{type:"number",min:1,value:e.quantity,max:e.variant.inventory_mode==="finite"?Math.max(1,Number(e.variant.inventory_count||0)):void 0,onChange:a=>{const r=Number(a.target.value);if(e.variant.inventory_mode==="finite"){const i=Math.max(1,Number(e.variant.inventory_count||0));W(e.variant.id,Math.min(i,Math.max(1,r)));return}W(e.variant.id,Math.max(1,r))},className:"w-16 rounded-lg border border-white/20 bg-black/35 px-2 py-1 text-xs min-h-11"}),t.jsx("p",{className:"text-xs text-gold",children:N(e.lineTotal,e.product.currency)})]}),e.variant.inventory_mode==="finite"&&Number(e.variant.inventory_count||0)<=H&&t.jsxs("p",{className:"mt-1 text-[10px] text-gold",children:["Stock left: ",Math.max(0,Number(e.variant.inventory_count||0))]})]},e.variant.id)),!g.length&&t.jsx("p",{className:"text-sm text-white/55",children:"No items yet."})]}),t.jsxs("div",{className:"mt-4",children:[t.jsx("label",{className:"text-[10px] uppercase tracking-[0.2em] text-white/55",htmlFor:"promo-code",children:"Promo code"}),t.jsx("input",{id:"promo-code",value:C,onChange:e=>P(e.target.value),className:"mt-1 w-full rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm min-h-11",placeholder:"Optional"})]}),t.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[t.jsx("p",{className:"text-sm text-white/70",children:"Subtotal"}),t.jsx("p",{className:"text-sm text-gold",children:N($)})]}),t.jsx("p",{className:"mt-1 text-[11px] text-white/55",children:"Tax and shipping are calculated by Stripe at checkout."}),t.jsx("button",{type:"button",onClick:B,disabled:O,className:"mt-4 w-full rounded-full bg-ember px-4 py-3 text-xs uppercase tracking-[0.24em] text-ink min-h-11 disabled:opacity-60",children:O?"Redirecting...":"Checkout"})]})]}),v&&t.jsx("p",{className:"mt-4 text-sm text-gold",children:v})]})}export{ne as default};
