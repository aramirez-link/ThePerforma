import{j as t}from"./jsx-runtime.TBa3i5EZ.js";import{r as u}from"./index.CVf8TyFT.js";import{b as E,f as $,L as de,m as ue,n as xe,a as me,o as pe,p as he,q as Q,t as ge}from"./storefront.DD1YA6uZ.js";import"./index.BtUICepX.js";const ee="the-performa-store-cart-v1",be=()=>{if(typeof window>"u")return[];try{const o=localStorage.getItem(ee);if(!o)return[];const m=JSON.parse(o);return Array.isArray(m)?m.filter(s=>s&&typeof s.variantId=="string").map(s=>({variantId:s.variantId,quantity:Math.max(1,Number(s.quantity||1))})):[]}catch{return[]}},T=o=>{typeof window>"u"||localStorage.setItem(ee,JSON.stringify(o))},Y=o=>{if(!o.length)return 0;const m=o.reduce((s,d)=>s+d,0);return Math.round(m/o.length*10)/10},f="store-product-media",Z="https://iahvjkodgrwatcpjdxna.supabase.co".trim(),v=Z?Z.replace(/\/+$/,""):"",fe=/^[a-zA-Z]:[\\/]/,we=/<[^>]+>/,y=o=>{try{return encodeURI(o)}catch{return o}},ve=o=>{const m=String(o||"").trim();if(!m)return null;let s=m.replace(/^['"]+|['"]+$/g,"").trim();if(s.startsWith("{")&&s.endsWith("}"))try{const d=JSON.parse(s),w=typeof d.url=="string"&&d.url||typeof d.src=="string"&&d.src||typeof d.path=="string"&&d.path||typeof d.key=="string"&&d.key||"";s=String(w||"").trim()}catch{s=m}if(!s||fe.test(s)||we.test(s))return null;if(/^data:image\//i.test(s))return s;if(/^https?:\/\//i.test(s))return y(s);if(s.startsWith("//")){const d=typeof window<"u"?window.location.protocol:"https:";return y(`${d}${s}`)}if(s.startsWith("/storage/")&&v)return y(`${v}${s}`);if(s.startsWith("/"))return y(s);if(s.startsWith("storage/v1/object/public/")&&v)return y(`${v}/${s}`);if(s.startsWith(`${f}/`)&&v){const d=s.replace(new RegExp(`^${f}/`),"");return y(`${v}/storage/v1/object/public/${f}/${d}`)}if(v){const d=`/storage/v1/object/public/${f}/`;if(s.includes(d)){const N=s.indexOf(d),h=s.slice(N+d.length).replace(/^\/+/,"");if(h)return y(`${v}/storage/v1/object/public/${f}/${h}`)}if(s.includes(`${f}/`)){const N=s.indexOf(`${f}/`),h=s.slice(N+`${f}/`.length).replace(/^\/+/,"");if(h.includes("/"))return y(`${v}/storage/v1/object/public/${f}/${h}`)}const w=s.replace(new RegExp(`^${f}/`),"").replace(/^\/+/,"");if(w.includes("/")&&!w.includes(" "))return y(`${v}/storage/v1/object/public/${f}/${w}`)}return null},X=o=>{const m=[o.cover_image,...o.gallery||[]].map(s=>String(s||"").trim()).filter(Boolean).map(s=>ve(s)).filter(Boolean);return Array.from(new Set(m))};function Se(){const[o,m]=u.useState([]),[s,d]=u.useState([]),[w,N]=u.useState({}),[h,_]=u.useState([]),[I,te]=u.useState("all"),[L,re]=u.useState(""),[U,A]=u.useState(!0),[O,R]=u.useState(!1),[P,x]=u.useState(""),[M,se]=u.useState(""),[q,W]=u.useState(null),[B,S]=u.useState(0),[g,V]=u.useState({productId:"",rating:5,title:"",body:""});u.useEffect(()=>{(async()=>{A(!0);const[r,a]=await Promise.all([ue(),xe()]),i=await me();if(se(i?.email||""),r.ok){m(r.data);const l={};for(const p of r.data)p.defaultVariant&&(l[p.id]=p.defaultVariant.id);N(l)}else x(r.error);a.ok&&d(a.data),_(be()),A(!1)})()},[]),u.useEffect(()=>{if(typeof window>"u"||!o.length)return;const r=(new URL(window.location.href).searchParams.get("product")||"").trim().toLowerCase();if(!r)return;const a=o.find(i=>i.slug.toLowerCase()===r);a&&(W(a.id),S(0))},[o]),u.useEffect(()=>{if(!P)return;const e=window.setTimeout(()=>x(""),2400);return()=>window.clearTimeout(e)},[P]);const D=u.useMemo(()=>I==="all"?o:o.filter(e=>e.product_type===I),[I,o]),c=u.useMemo(()=>o.find(e=>e.id===q)||null,[o,q]),j=u.useMemo(()=>c?X(c):[],[c]),F=u.useMemo(()=>{const e=new Map;for(const r of o)for(const a of r.variants)e.set(a.id,{product:r,variant:a});return e},[o]),C=u.useMemo(()=>h.map(e=>{const r=F.get(e.variantId);return r?{...e,...r,lineTotal:r.variant.price_cents*e.quantity}:null}).filter(Boolean),[h,F]),ae=C.reduce((e,r)=>e+r.lineTotal,0),z=async e=>{const r=s.includes(e),a=r?await pe(e):await he(e);if(!a.ok){x(a.error);return}d(i=>r?i.filter(l=>l!==e):[e,...i]),x(r?"Removed from wishlist.":"Saved to wishlist.")},H=(e,r)=>{N(a=>({...a,[e]:r}))},J=e=>{const r=w[e.id]||e.defaultVariant?.id;if(!r){x("No variant available for this product.");return}const a=e.variants.find(b=>b.id===r)||null;if(!a){x("Selected variant is unavailable.");return}const i=E(a);if(i.outOfStock){x("This variant is currently out of stock.");return}const l=[...h],p=l.find(b=>b.variantId===r);if(p){const b=p.quantity+1;if(i.remaining!=null&&b>i.remaining){x(`Only ${i.remaining} left in stock.`);return}p.quantity=b}else l.unshift({variantId:r,quantity:1});_(l),T(l),x("Added to cart.")},G=(e,r)=>{if(r<=0){const i=h.filter(l=>l.variantId!==e);_(i),T(i);return}const a=h.map(i=>i.variantId===e?{...i,quantity:r}:i);_(a),T(a)},ie=async()=>{if(!C.length){x("Your cart is empty.");return}if(!M){x("Log in to Fan Vault before checkout.");return}R(!0);const e=window.location.origin,r=await Q({items:C.map(a=>({variantId:a.variant.id,quantity:a.quantity})),promoCode:L.trim()||void 0,successUrl:`${e}/store?checkout=success`,cancelUrl:`${e}/store?checkout=cancelled`});if(R(!1),!r.ok){x(r.error);return}window.location.assign(r.data.checkoutUrl)},ne=e=>{W(e.id),S(0);const r=new URL(window.location.href);r.searchParams.set("product",e.slug),window.history.replaceState({},"",`${r.pathname}${r.search}`)},le=()=>{W(null),S(0);const e=new URL(window.location.href);e.searchParams.delete("product"),window.history.replaceState({},"",`${e.pathname}${e.search}`)},oe=async e=>{const r=w[e.id]||e.defaultVariant?.id;if(!r){x("No variant available for this product.");return}const a=e.variants.find(b=>b.id===r)||null;if(!a){x("Selected variant is unavailable.");return}if(E(a).outOfStock){x("This variant is currently out of stock.");return}if(!M){x("Log in to Fan Vault before checkout.");return}R(!0);const l=window.location.origin,p=await Q({items:[{variantId:a.id,quantity:1}],promoCode:L.trim()||void 0,successUrl:`${l}/store?checkout=success`,cancelUrl:`${l}/store?checkout=cancelled`});if(R(!1),!p.ok){x(p.error);return}window.location.assign(p.data.checkoutUrl)},ce=async e=>{if(!g.body.trim()||!g.title.trim()){x("Write a title and review body.");return}const r=await ge({productId:e,rating:g.rating,title:g.title,body:g.body});if(!r.ok){x(r.error);return}V({productId:"",rating:5,title:"",body:""}),x("Review submitted for moderation.")};return t.jsxs("section",{className:"mx-auto w-full max-w-6xl px-4 pb-20 pt-8 sm:px-6",children:[t.jsxs("div",{className:"rounded-[2rem] border border-white/15 bg-black/45 p-6 backdrop-blur-xl",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.32em] text-gold/80",children:"Performa Store"}),t.jsx("h1",{className:"mt-2 font-display text-4xl",children:"Merch, DJ Tools, and Digital Drops"}),t.jsx("p",{className:"mt-3 max-w-3xl text-sm text-white/70",children:"Worldwide checkout with Stripe, promo codes, and private digital delivery links for downloads and tool packs."}),t.jsx("div",{className:"mt-5 flex flex-wrap gap-2",children:["all","physical","digital_tool","digital_download","subscription","bundle"].map(e=>t.jsx("button",{type:"button",onClick:()=>te(e),className:`rounded-full border px-4 py-2 text-[10px] uppercase tracking-[0.24em] min-h-11 ${I===e?"border-gold/70 bg-gold/10 text-gold":"border-white/20 text-white/75"}`,children:e.replace("_"," ")},e))})]}),t.jsxs("div",{className:"mt-7 grid gap-4 lg:grid-cols-[1fr_320px]",children:[t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[U&&t.jsx("p",{className:"text-sm text-white/70",children:"Loading store..."}),!U&&!D.length&&t.jsx("article",{className:"rounded-3xl border border-white/15 bg-black/35 p-6 text-sm text-white/70",children:"No products published yet."}),D.map(e=>{const r=w[e.id]||e.defaultVariant?.id||"",a=e.variants.find(n=>n.id===r)||e.defaultVariant,i=a?E(a):{outOfStock:!1,lowStock:!1,remaining:null},l=e.reviews.map(n=>n.rating),b=X(e)[0]||null,K=e.related_product_ids.map(n=>o.find(k=>k.id===n)).filter(Boolean).slice(0,2);return t.jsxs("article",{className:"rounded-3xl border border-white/15 bg-black/35 p-5 backdrop-blur",children:[b&&t.jsx("img",{src:b,alt:e.name,className:"h-48 w-full rounded-2xl border border-white/10 object-cover",loading:"lazy"}),t.jsx("p",{className:"mt-4 text-[10px] uppercase tracking-[0.24em] text-gold/80",children:e.product_type.replace("_"," ")}),t.jsx("h2",{className:"mt-2 text-2xl font-semibold",children:e.name}),t.jsx("p",{className:"mt-2 text-sm text-white/70",children:e.description}),t.jsxs("div",{className:"mt-4 flex items-center justify-between gap-2",children:[t.jsx("p",{className:"text-sm text-gold",children:$(a?.price_cents||e.base_price_cents,e.currency)}),t.jsx("p",{className:"text-xs text-white/55",children:l.length?`${Y(l)} / 5 (${l.length})`:"No ratings yet"})]}),i.outOfStock&&t.jsx("p",{className:"mt-2 inline-flex rounded-full border border-rose-400/50 bg-rose-500/10 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-rose-200",children:"Out of stock"}),!i.outOfStock&&i.lowStock&&t.jsxs("p",{className:"mt-2 inline-flex rounded-full border border-gold/50 bg-gold/10 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-gold",children:["Low stock: ",i.remaining," left"]}),!!e.variants.length&&t.jsx("select",{value:r,onChange:n=>H(e.id,n.target.value),className:"mt-3 w-full rounded-xl border border-white/20 bg-black/40 px-3 py-2 text-sm min-h-11",children:e.variants.map(n=>t.jsxs("option",{value:n.id,children:[n.title," (",$(n.price_cents,e.currency),")"]},n.id))}),t.jsxs("div",{className:"mt-4 flex gap-2",children:[t.jsx("button",{type:"button",onClick:()=>ne(e),className:"rounded-full border border-gold/45 px-5 py-2 text-[11px] uppercase tracking-[0.24em] text-gold min-h-11",children:"View Product"}),t.jsx("button",{type:"button",onClick:()=>J(e),disabled:i.outOfStock,className:"rounded-full bg-ember px-5 py-2 text-[11px] uppercase tracking-[0.24em] text-ink min-h-11 disabled:opacity-50",children:i.outOfStock?"Sold out":"Add to cart"}),t.jsx("button",{type:"button",onClick:()=>z(e.id),className:"rounded-full border border-white/30 px-5 py-2 text-[11px] uppercase tracking-[0.24em] text-white/80 min-h-11",children:s.includes(e.id)?"Wishlisted":"Wishlist"})]}),!!K.length&&t.jsxs("div",{className:"mt-4 rounded-2xl border border-white/10 bg-black/30 p-3",children:[t.jsx("p",{className:"text-[10px] uppercase tracking-[0.22em] text-white/55",children:"Related"}),t.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-xs text-white/75",children:K.map(n=>t.jsx("span",{className:"rounded-full border border-white/15 px-3 py-1",children:n.name},n.id))})]}),t.jsxs("div",{className:"mt-4 rounded-2xl border border-white/10 bg-black/30 p-3",children:[t.jsx("p",{className:"text-[10px] uppercase tracking-[0.22em] text-white/55",children:"Reviews"}),t.jsxs("div",{className:"mt-2 space-y-2",children:[e.reviews.slice(0,2).map(n=>t.jsxs("article",{className:"rounded-xl border border-white/10 p-2",children:[t.jsx("p",{className:"text-xs text-gold",children:"â˜…".repeat(Math.max(1,n.rating))}),t.jsx("p",{className:"text-xs text-white/85",children:n.title}),t.jsx("p",{className:"text-xs text-white/65",children:n.body})]},n.id)),!e.reviews.length&&t.jsx("p",{className:"text-xs text-white/55",children:"No approved reviews yet."})]}),t.jsxs("details",{className:"mt-2",children:[t.jsx("summary",{className:"cursor-pointer text-xs uppercase tracking-[0.2em] text-gold",children:"Write a review"}),t.jsxs("div",{className:"mt-2 grid gap-2",children:[t.jsx("input",{value:g.productId===e.id?g.title:"",onChange:n=>V(k=>({...k,productId:e.id,title:n.target.value})),className:"rounded-lg border border-white/20 bg-black/35 px-3 py-2 text-xs min-h-11",placeholder:"Review title"}),t.jsx("textarea",{value:g.productId===e.id?g.body:"",onChange:n=>V(k=>({...k,productId:e.id,body:n.target.value})),rows:3,className:"rounded-lg border border-white/20 bg-black/35 px-3 py-2 text-xs",placeholder:"Share your experience"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("select",{value:g.productId===e.id?g.rating:5,onChange:n=>V(k=>({...k,productId:e.id,rating:Number(n.target.value)})),className:"rounded-lg border border-white/20 bg-black/35 px-3 py-2 text-xs min-h-11",children:[5,4,3,2,1].map(n=>t.jsxs("option",{value:n,children:[n," stars"]},n))}),t.jsx("button",{type:"button",onClick:()=>ce(e.id),className:"rounded-full border border-gold/45 px-4 py-2 text-[10px] uppercase tracking-[0.22em] text-gold min-h-11",children:"Submit"})]})]})]})]})]},e.id)})]}),t.jsxs("aside",{className:"h-fit rounded-3xl border border-white/15 bg-black/45 p-5 backdrop-blur",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.28em] text-gold/80",children:"Cart"}),!M&&t.jsxs("p",{className:"mt-2 text-[11px] text-white/65",children:["Checkout requires Fan Vault login. ",t.jsx("a",{href:"/fan-club",className:"text-gold underline",children:"Log in here"}),"."]}),t.jsxs("div",{className:"mt-3 space-y-3",children:[C.map(e=>t.jsxs("article",{className:"rounded-xl border border-white/10 p-3",children:[t.jsx("p",{className:"text-xs text-white/90",children:e.product.name}),t.jsx("p",{className:"text-[11px] text-white/60",children:e.variant.title}),t.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[t.jsx("input",{type:"number",min:1,value:e.quantity,max:e.variant.inventory_mode==="finite"?Math.max(1,Number(e.variant.inventory_count||0)):void 0,onChange:r=>{const a=Number(r.target.value);if(e.variant.inventory_mode==="finite"){const i=Math.max(1,Number(e.variant.inventory_count||0));G(e.variant.id,Math.min(i,Math.max(1,a)));return}G(e.variant.id,Math.max(1,a))},className:"w-16 rounded-lg border border-white/20 bg-black/35 px-2 py-1 text-xs min-h-11"}),t.jsx("p",{className:"text-xs text-gold",children:$(e.lineTotal,e.product.currency)})]}),e.variant.inventory_mode==="finite"&&Number(e.variant.inventory_count||0)<=de&&t.jsxs("p",{className:"mt-1 text-[10px] text-gold",children:["Stock left: ",Math.max(0,Number(e.variant.inventory_count||0))]})]},e.variant.id)),!C.length&&t.jsx("p",{className:"text-sm text-white/55",children:"No items yet."})]}),t.jsxs("div",{className:"mt-4",children:[t.jsx("label",{className:"text-[10px] uppercase tracking-[0.2em] text-white/55",htmlFor:"promo-code",children:"Promo code"}),t.jsx("input",{id:"promo-code",value:L,onChange:e=>re(e.target.value),className:"mt-1 w-full rounded-xl border border-white/20 bg-black/35 px-3 py-2 text-sm min-h-11",placeholder:"Optional"})]}),t.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[t.jsx("p",{className:"text-sm text-white/70",children:"Subtotal"}),t.jsx("p",{className:"text-sm text-gold",children:$(ae)})]}),t.jsx("p",{className:"mt-1 text-[11px] text-white/55",children:"Tax and shipping are calculated by Stripe at checkout."}),t.jsx("button",{type:"button",onClick:ie,disabled:O,className:"mt-4 w-full rounded-full bg-ember px-4 py-3 text-xs uppercase tracking-[0.24em] text-ink min-h-11 disabled:opacity-60",children:O?"Redirecting...":"Checkout"})]})]}),P&&t.jsx("p",{className:"mt-4 text-sm text-gold",children:P}),c&&t.jsx("div",{className:"fixed inset-0 z-[70] bg-black/80 backdrop-blur-sm",children:t.jsx("div",{className:"mx-auto flex h-full w-full max-w-6xl items-center px-4 py-6 sm:px-6",children:t.jsxs("article",{className:"max-h-[92vh] w-full overflow-y-auto rounded-3xl border border-white/15 bg-black/90 p-5 sm:p-6",children:[t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-[10px] uppercase tracking-[0.24em] text-gold/80",children:c.product_type.replace("_"," ")}),t.jsx("h2",{className:"mt-2 text-3xl font-semibold",children:c.name})]}),t.jsx("button",{type:"button",onClick:le,className:"min-h-11 rounded-full border border-white/30 px-4 py-2 text-[10px] uppercase tracking-[0.22em] text-white/80",children:"Close"})]}),t.jsxs("div",{className:"mt-4 grid gap-5 lg:grid-cols-[1.2fr_1fr]",children:[t.jsx("div",{children:j.length>0?t.jsxs("div",{className:"rounded-2xl border border-white/15 bg-black/40 p-3",children:[t.jsxs("div",{className:"relative overflow-hidden rounded-xl border border-white/10",children:[t.jsx("img",{src:j[Math.max(0,Math.min(B,j.length-1))],alt:c.name,className:"max-h-[30rem] w-full object-cover"}),j.length>1&&t.jsxs("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-between p-2",children:[t.jsx("button",{type:"button",onClick:()=>S(e=>e<=0?j.length-1:e-1),className:"pointer-events-auto min-h-10 rounded-full border border-white/40 bg-black/50 px-3 py-2 text-xs text-white",children:"Prev"}),t.jsx("button",{type:"button",onClick:()=>S(e=>e>=j.length-1?0:e+1),className:"pointer-events-auto min-h-10 rounded-full border border-white/40 bg-black/50 px-3 py-2 text-xs text-white",children:"Next"})]})]}),j.length>1&&t.jsx("div",{className:"mt-3 grid grid-cols-4 gap-2 sm:grid-cols-6",children:j.map((e,r)=>t.jsx("button",{type:"button",onClick:()=>S(r),className:`overflow-hidden rounded-lg border ${r===B?"border-gold/70":"border-white/20"}`,children:t.jsx("img",{src:e,alt:"",className:"h-16 w-full object-cover"})},`${c.id}-image-${r}`))})]}):t.jsx("div",{className:"rounded-2xl border border-white/15 bg-black/35 p-6 text-sm text-white/60",children:"No product images uploaded yet."})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-white/70 whitespace-pre-wrap",children:c.description||"No description added yet."}),(()=>{const e=w[c.id]||c.defaultVariant?.id||"",r=c.variants.find(l=>l.id===e)||c.defaultVariant,a=r?E(r):{outOfStock:!1,lowStock:!1,remaining:null},i=c.reviews.map(l=>l.rating);return t.jsxs("div",{className:"mt-4 rounded-2xl border border-white/15 bg-black/35 p-4",children:[t.jsx("p",{className:"text-[10px] uppercase tracking-[0.22em] text-white/55",children:"Pricing"}),t.jsx("p",{className:"mt-2 text-xl text-gold",children:$(r?.price_cents||c.base_price_cents,c.currency)}),t.jsx("p",{className:"mt-1 text-xs text-white/55",children:i.length?`${Y(i)} / 5 (${i.length} reviews)`:"No ratings yet"}),!!c.variants.length&&t.jsx("select",{value:e,onChange:l=>H(c.id,l.target.value),className:"mt-3 w-full rounded-xl border border-white/20 bg-black/40 px-3 py-2 text-sm min-h-11",children:c.variants.map(l=>t.jsxs("option",{value:l.id,children:[l.title," (",$(l.price_cents,c.currency),")"]},l.id))}),a.outOfStock&&t.jsx("p",{className:"mt-3 inline-flex rounded-full border border-rose-400/50 bg-rose-500/10 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-rose-200",children:"Out of stock"}),!a.outOfStock&&a.lowStock&&t.jsxs("p",{className:"mt-3 inline-flex rounded-full border border-gold/50 bg-gold/10 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-gold",children:["Low stock: ",a.remaining," left"]}),t.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",onClick:()=>oe(c),disabled:O||a.outOfStock,className:"min-h-11 rounded-full bg-ember px-5 py-2 text-[11px] uppercase tracking-[0.24em] text-ink disabled:opacity-50",children:O?"Redirecting...":"Order now"}),t.jsx("button",{type:"button",onClick:()=>J(c),disabled:a.outOfStock,className:"min-h-11 rounded-full border border-white/30 px-5 py-2 text-[11px] uppercase tracking-[0.24em] text-white/85 disabled:opacity-50",children:"Add to cart"}),t.jsx("button",{type:"button",onClick:()=>z(c.id),className:"min-h-11 rounded-full border border-gold/45 px-5 py-2 text-[11px] uppercase tracking-[0.24em] text-gold",children:s.includes(c.id)?"Wishlisted":"Wishlist"})]})]})})()]})]})]})})})]})}export{Se as default};
