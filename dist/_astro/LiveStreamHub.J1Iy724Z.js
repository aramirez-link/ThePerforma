import{j as e}from"./jsx-runtime.TBa3i5EZ.js";import{r as s}from"./index.CVf8TyFT.js";import{c as R}from"./index.BtUICepX.js";import{j as A,n as D}from"./fanVault.BPqpPtzw.js";const J="the-performa-live-status-v1",U="the-performa-live-dispatch-logs-v1",O="the-performa-operator-token-v1",P="the-performa-operator-name-v1",Y=()=>{try{return JSON.parse(localStorage.getItem(U)||"[]")}catch{return[]}};function F(){const[l,i]=s.useState(!1),[m,u]=s.useState(!1),[v,c]=s.useState(""),[d,S]=s.useState(()=>localStorage.getItem(O)||""),[r,h]=s.useState(()=>localStorage.getItem(P)||"chip-lee"),[x,j]=s.useState("Chip Lee Pop-Up Fan Stream"),[f,k]=s.useState("https://theperforma.com/live"),[b,I]=s.useState("youtube"),[p,t]=s.useState(!0),[o,_]=s.useState(!0),w=s.useMemo(()=>{const a="https://iahvjkodgrwatcpjdxna.supabase.co";try{const g=new URL(a).host.split(".")[0];return g?`https://${g}.functions.supabase.co/go-live-blast`:""}catch{return""}},[]),n=async a=>{if(!w){c("Missing Supabase URL. Configure PUBLIC_SUPABASE_URL.");return}if(!d.trim()){c("Enter operator token.");return}u(!0),c(""),localStorage.setItem(O,d.trim()),localStorage.setItem(P,r.trim()||"chip-lee");try{const y=await fetch(w,{method:"POST",headers:{Authorization:`Bearer ${d.trim()}`,"Content-Type":"application/json","x-operator":r.trim()||"chip-lee"},body:JSON.stringify({status:a,title:x,streamUrl:f,platform:b,sendEmail:p,sendSms:o})}),g=await y.json().catch(()=>({}));if(!y.ok){c(`Blast failed: ${g?.error||y.statusText}`);return}const C=Number(g?.result?.email?.sent||0),E=Number(g?.result?.sms?.sent||0),M={status:a,title:x,streamUrl:f,platform:b,updatedAt:new Date().toISOString()};localStorage.setItem(J,JSON.stringify(M)),window.dispatchEvent(new Event("performa:live-status"));const L=Y();L.unshift({id:`dispatch_${Date.now()}`,createdAt:new Date().toISOString(),status:a,title:x,streamUrl:f,platform:b,emailSent:C,smsSent:E}),localStorage.setItem(U,JSON.stringify(L.slice(0,40))),window.dispatchEvent(new Event("performa:dispatch-log")),c(`Blast sent. Email ${C}, SMS ${E}.`)}catch{c("Blast request failed.")}finally{u(!1)}};return e.jsxs("div",{className:"rounded-2xl border border-white/15 bg-black/45 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.28em] text-white/55",children:"Operator Console"}),e.jsx("button",{type:"button",onClick:()=>i(a=>!a),className:"rounded-full border border-white/25 px-3 py-1 text-[10px] uppercase tracking-[0.2em] text-white/75",children:l?"Hide":"Open"})]}),l&&e.jsxs("div",{className:"mt-3 grid gap-3",children:[e.jsx("input",{value:r,onChange:a=>h(a.target.value),className:"rounded-xl border border-white/20 bg-black/45 px-3 py-2 text-xs text-white/85",placeholder:"Operator name"}),e.jsx("input",{value:d,onChange:a=>S(a.target.value),className:"rounded-xl border border-white/20 bg-black/45 px-3 py-2 text-xs text-white/85",placeholder:"LIVE_BLAST_TOKEN",type:"password"}),e.jsx("input",{value:x,onChange:a=>j(a.target.value),className:"rounded-xl border border-white/20 bg-black/45 px-3 py-2 text-xs text-white/85",placeholder:"Stream title"}),e.jsx("input",{value:f,onChange:a=>k(a.target.value),className:"rounded-xl border border-white/20 bg-black/45 px-3 py-2 text-xs text-white/85",placeholder:"Stream URL"}),e.jsxs("label",{className:"text-xs text-white/80",children:["Platform",e.jsxs("select",{className:"mt-1 w-full rounded-xl border border-white/20 bg-black/45 px-3 py-2 text-xs text-white/85",value:b,onChange:a=>I(a.target.value),children:[e.jsx("option",{value:"youtube",children:"YouTube"}),e.jsx("option",{value:"instagram",children:"Instagram"}),e.jsx("option",{value:"facebook",children:"Facebook"}),e.jsx("option",{value:"twitch",children:"Twitch"}),e.jsx("option",{value:"multi",children:"Multi"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-white/75",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:a=>t(a.target.checked)}),"Email"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:a=>_(a.target.checked)}),"SMS"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:()=>void n("live"),disabled:m,className:"rounded-full bg-ember px-4 py-2 text-[10px] uppercase tracking-[0.2em] text-ink disabled:opacity-60",children:"Go Live"}),e.jsx("button",{type:"button",onClick:()=>void n("test"),disabled:m,className:"rounded-full border border-white/30 px-4 py-2 text-[10px] uppercase tracking-[0.2em] text-white/75 disabled:opacity-60",children:"Test Blast"}),e.jsx("button",{type:"button",onClick:()=>void n("offline"),disabled:m,className:"rounded-full border border-white/30 px-4 py-2 text-[10px] uppercase tracking-[0.2em] text-white/75 disabled:opacity-60",children:"End Live"})]}),v&&e.jsx("p",{className:"text-[11px] text-gold",children:v})]})]})}const B="the-performa-live-alerts-v1",K="the-performa-live-status-v1",N={enabled:!0,emailAlerts:!0,smsAlerts:!1,smsPhone:"",preferredPlatform:"multi",updatedAt:new Date().toISOString()},$=[{label:"YouTube",href:"https://www.youtube.com/@chipleetheperforma/live"},{label:"Instagram Live",href:"https://www.instagram.com/chiplee_theperforma/"},{label:"Facebook Live",href:"https://www.facebook.com/people/Chipleetheperforma/61572970724635/"}],z="https://www.youtube.com/embed/PvrXChRa7LI?rel=0",T=()=>R("https://iahvjkodgrwatcpjdxna.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhaHZqa29kZ3J3YXRjcGpkeG5hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3MDEwMzAsImV4cCI6MjA4NjI3NzAzMH0.0crxct3Pq52ZhymeTQ05_k8tZdg4KtYaZw92B7d_DKM",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),V=l=>{try{const i=localStorage.getItem(`${B}:${l}`);return i?{...N,...JSON.parse(i)}:N}catch{return N}},Z=(l,i)=>{localStorage.setItem(`${B}:${l}`,JSON.stringify(i))};function Q(){const[l,i]=s.useState(null),[m,u]=s.useState(!0),[v,c]=s.useState(!1),[d,S]=s.useState(""),[r,h]=s.useState(N),[x,j]=s.useState(null),f=s.useMemo(()=>"".split(",").map(t=>t.trim().toLowerCase()).filter(Boolean),[]),k=!!l,b=!!(l?.email&&f.includes(l.email.toLowerCase()));s.useEffect(()=>{(async()=>{u(!0);const o=await D();if(i(o),!o){u(!1);return}const _=V(o.id);if(h(_),A){const w=T();if(w){const{data:n}=await w.from("fan_live_subscriptions").select("enabled,email_alerts,sms_alerts,sms_phone,preferred_platform,updated_at").eq("user_id",o.id).maybeSingle();n&&h({enabled:!!n.enabled,emailAlerts:!!n.email_alerts,smsAlerts:!!n.sms_alerts,smsPhone:n.sms_phone?String(n.sms_phone):"",preferredPlatform:n.preferred_platform||"multi",updatedAt:n.updated_at||new Date().toISOString()})}}u(!1)})()},[]),s.useEffect(()=>{if(!d)return;const t=window.setTimeout(()=>S(""),2200);return()=>window.clearTimeout(t)},[d]),s.useEffect(()=>{const t=()=>{try{const o=localStorage.getItem(K);j(o?JSON.parse(o):null)}catch{j(null)}};return t(),window.addEventListener("performa:live-status",t),window.addEventListener("storage",t),()=>{window.removeEventListener("performa:live-status",t),window.removeEventListener("storage",t)}},[]);const I=s.useMemo(()=>A&&!!l,[l]),p=async t=>{if(l){if(h(t),Z(l.id,t),c(!0),I){const o=T();o&&await o.from("fan_live_subscriptions").upsert({user_id:l.id,enabled:t.enabled,email_alerts:t.emailAlerts,sms_alerts:t.smsAlerts,sms_phone:t.smsPhone||null,preferred_platform:t.preferredPlatform,updated_at:new Date().toISOString()},{onConflict:"user_id"})}c(!1),S("Live alert preferences saved.")}};return e.jsxs("div",{className:"rounded-[2rem] border border-white/15 bg-black/50 p-5 md:p-7 shadow-[0_0_70px_rgba(242,84,45,0.12)]",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.32em] text-gold/80",children:"Chip Lee Pop-Up Fan Streams"}),x?.status==="live"&&e.jsx("p",{className:"mt-2 inline-flex rounded-full border border-ember/60 bg-ember/15 px-3 py-1 text-[10px] uppercase tracking-[0.24em] text-gold",children:"Live Now"}),e.jsx("h3",{className:"mt-3 font-display text-2xl md:text-3xl",children:"Live Stream Command Deck"}),e.jsx("p",{className:"mt-3 max-w-3xl text-sm text-white/70",children:"Go live directly from the portal, trigger fan alerts for registered users, and simulcast your stream feed out to major platforms."}),e.jsxs("div",{className:"mt-6 grid gap-5 lg:grid-cols-[1.6fr_1fr]",children:[e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-white/15 bg-black/45",children:[e.jsx("div",{className:"aspect-video w-full",children:e.jsx("iframe",{className:"h-full w-full",src:z,title:"Chip Lee Pop-Up Fan Stream",loading:"lazy",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 border-t border-white/10 p-3",children:[e.jsx("p",{className:"text-xs text-white/65",children:"Set this embed to the current live URL before going on air for pop-up stream sessions."}),e.jsx("a",{href:"/watch",className:"inline-flex min-h-11 items-center rounded-full border border-white/25 px-3 py-2 text-[10px] uppercase tracking-[0.2em] text-white/80",children:"Open Watch"})]})]}),e.jsxs("aside",{className:"rounded-2xl border border-white/15 bg-black/45 p-4",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.28em] text-white/55",children:"On-Air Alerts"}),m&&e.jsx("p",{className:"mt-3 text-sm text-white/65",children:"Loading your alert settings..."}),!m&&!k&&e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsx("p",{className:"text-sm text-white/70",children:"Register or log in to Fan Vault for live-on-air notifications."}),e.jsx("a",{href:"/fan-club",className:"inline-flex min-h-11 items-center rounded-full bg-ember px-4 py-2 text-[10px] uppercase tracking-[0.24em] text-ink",children:"Open Fan Vault"})]}),!m&&k&&e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("p",{className:"text-sm text-white/75",children:[l?.name,", control how you get notified when Chip Lee is on air."]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-white/80",children:[e.jsx("input",{type:"checkbox",checked:r.enabled,onChange:t=>void p({...r,enabled:t.target.checked,updatedAt:new Date().toISOString()}),className:"h-4 w-4 shrink-0 accent-ember"}),"Enable live alerts"]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-white/80",children:[e.jsx("input",{type:"checkbox",checked:r.emailAlerts,onChange:t=>void p({...r,emailAlerts:t.target.checked,updatedAt:new Date().toISOString()}),disabled:!r.enabled,className:"h-4 w-4 shrink-0 accent-ember"}),"Email me when stream starts"]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-white/80",children:[e.jsx("input",{type:"checkbox",checked:r.smsAlerts,onChange:t=>void p({...r,smsAlerts:t.target.checked,updatedAt:new Date().toISOString()}),disabled:!r.enabled,className:"h-4 w-4 shrink-0 accent-ember"}),"SMS priority ping"]}),e.jsxs("label",{className:"block text-xs text-white/80",children:["SMS phone",e.jsx("input",{type:"tel",value:r.smsPhone,onChange:t=>h(o=>({...o,smsPhone:t.target.value})),onBlur:()=>void p({...r,smsPhone:r.smsPhone.trim(),updatedAt:new Date().toISOString()}),placeholder:"+1 404 555 0123",disabled:!r.enabled||!r.smsAlerts,className:"mt-1 w-full rounded-xl border border-white/20 bg-black/45 px-3 py-2 text-sm text-white/85 placeholder:text-white/35 min-h-11"})]}),e.jsxs("label",{className:"block text-xs text-white/80",children:["Preferred platform",e.jsxs("select",{className:"mt-1 w-full rounded-xl border border-white/20 bg-black/45 px-3 py-2 text-sm text-white/85 min-h-11",style:{color:"#f5f5f7",backgroundColor:"#111318"},value:r.preferredPlatform,onChange:t=>void p({...r,preferredPlatform:t.target.value,updatedAt:new Date().toISOString()}),disabled:!r.enabled,children:[e.jsx("option",{value:"multi",style:{color:"#0f1116",backgroundColor:"#ffffff"},children:"All Platforms"}),e.jsx("option",{value:"youtube",style:{color:"#0f1116",backgroundColor:"#ffffff"},children:"YouTube"}),e.jsx("option",{value:"instagram",style:{color:"#0f1116",backgroundColor:"#ffffff"},children:"Instagram"}),e.jsx("option",{value:"facebook",style:{color:"#0f1116",backgroundColor:"#ffffff"},children:"Facebook"}),e.jsx("option",{value:"twitch",style:{color:"#0f1116",backgroundColor:"#ffffff"},children:"Twitch"})]})]}),d&&e.jsx("p",{className:"text-[11px] text-gold",children:d}),v&&e.jsx("p",{className:"text-[11px] text-white/55",children:"Saving..."}),e.jsx("p",{className:"text-[11px] text-white/45",children:"Tip: connect Zapier/Make to your stream status and this alert list for automated blast notifications."})]})]})]}),e.jsxs("div",{className:"mt-5 rounded-2xl border border-white/10 bg-black/35 p-4",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.28em] text-white/55",children:"Simulcast Targets"}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:$.map(t=>e.jsx("a",{href:t.href,target:"_blank",rel:"noreferrer",className:"inline-flex min-h-11 items-center rounded-full border border-white/20 px-3 py-2 text-[10px] uppercase tracking-[0.2em] text-white/75 hover:border-gold/45 hover:text-gold",children:t.label},t.label))})]}),b&&e.jsx("div",{className:"mt-5",children:e.jsx(F,{})})]})}export{Q as default};
